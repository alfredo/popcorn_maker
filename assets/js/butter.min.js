/*! This Source Code Form is subject to the terms of the MIT license
 * If a copy of the MIT license was not distributed with this file, you can
 * obtain one at http://www.mozillapopcorn.org/butter-license.txt */
(function(){var a,b,c;(function(d){function j(a,b){if(a&&a.charAt(0)==="."&&b){b=b.split("/"),b=b.slice(0,b.length-1),a=b.concat(a.split("/"));var c,d;for(c=0;d=a[c];c++)if(d===".")a.splice(c,1),c-=1;else if(d===".."){if(c===1&&(a[2]===".."||a[0]===".."))break;c>0&&(a.splice(c-1,2),c-=2)}a=a.join("/")}return a}function k(a,b){return function(){return i.apply(d,g.call(arguments,0).concat([a,b]))}}function l(a){return function(b){return j(b,a)}}function m(a){return function(b){e[a]=b}}function n(a){if(f.hasOwnProperty(a)){var b=f[a];delete f[a],h.apply(d,b)}return e[a]}function o(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=j(a.slice(0,e),b),a=a.slice(e+1),d=n(c),d&&d.normalize?a=d.normalize(a,l(b)):a=j(a,b)):a=j(a,b),{f:c?c+"!"+a:a,n:a,p:d}}var e={},f={},g=[].slice,h,i;if(typeof c=="function")return;h=function(a,b,c,g){var h=[],i,j,l,p,q,r;g||(g=a);if(typeof c=="function"){!b.length&&c.length&&(b=["require","exports","module"]);for(p=0;p<b.length;p++){r=o(b[p],g),l=r.f;if(l==="require")h[p]=k(a);else if(l==="exports")h[p]=e[a]={},i=!0;else if(l==="module")j=h[p]={id:a,uri:"",exports:e[a]};else if(e.hasOwnProperty(l)||f.hasOwnProperty(l))h[p]=n(l);else{if(!r.p)throw a+" missing "+l;r.p.load(r.n,k(g,!0),m(l),{}),h[p]=e[l]}}q=c.apply(e[a],h),a&&(j&&j.exports!==d?e[a]=j.exports:i||(e[a]=q))}else a&&(e[a]=c)},a=i=function(a,b,c,e){return typeof a=="string"?n(o(a,b).f):(a.splice||(b.splice?(a=b,b=arguments[2]):a=[]),e?h(d,a,b,c):setTimeout(function(){h(d,a,b,c)},15),i)},i.config=function(){return i},b||(b=i),c=function(a,b,d){b.splice||(d=b,b=[]),c.unordered?f[a]=[a,b,d]:h(a,b,d)},c.amd={jQuery:!0}})(),c("../tools/almond",function(){}),function(){function a(){return!0}var b=function(){b.__waiting||(b.__waiting=[]),b.__waiting.push(arguments)};window.Butter||(window.Butter=b)}(),c("butter",function(){}),c("core/eventmanager",[],function(){function a(a){return a.listen&&a.unlisten}function b(b,c,d){if(!a(c))throw"Error: Object is not a valid event source: "+c;var e=d.length;while(e--)c.listen(d[e],b.dispatch)}function c(b,c,d){if(!a(c))throw"Error: Object is not a valid event source: "+c;var e=d.length;while(e--)c.unlisten(d[e],b.dispatch)}function d(a,b,c){var d,e;if(b[a]){d=b[a].slice(),e=d.length;while(e--)d[e](c)}}function e(a,b,c,e,f,g){var h,i,j;typeof c=="object"?(i={type:c.type,target:c.target,data:c.data},c=i.type):i={type:c+"",target:a,data:e},j=b+c,g=!0,g?d(j,f,i):(h=document.createEvent("CustomEvent"),h.initCustomEvent(j,!1,!1,i),document.dispatchEvent(h))}function f(a,b,c,d,e,f){var g,h;if(typeof c=="object")for(g in c)c.hasOwnProperty(g)&&a.listen(g,c[g]);else h=b+c,e[h]||(e[h]=[],document.addEventListener(h,function(a){f(h,a)},!1)),e[h].push(d)}function g(a,b,c,d,e,f){var g,h,i,j=b+c;if(typeof c=="object")for(i in c)c.hasOwnProperty(i)&&a.unlisten(i,c[i]);else{g=e[j];if(!g)return;d&&(h=g.indexOf(d),h>-1&&g.splice(h,1));if(!d||g.length===0)delete e[j],document.removeEventListener(j,function(a){f(j,a)},!1)}}function i(i){if(!i||a(i))return;var j={},k="butter-"+h++ +":",l=function(a,b){d(a,j,b.detail)};return i.chain=function(a,c){b(this,a,c)},i.unchain=function(a,b){c(this,a,b)},i.dispatch=function(a,b,c){e(this,k,a,b,j,!!c)},i.listen=function(a,b){f(this,k,a,b,j,l)},i.unlisten=function(a,b){g(this,k,a,b,j,l)},i}var h=Date.now();return i}),function(a){var b=!1;c("core/logger",[],function(){function c(a){this.log=function(c){b&&console.log("["+a+"] "+c)},this.error=function(c){if(b)throw new Error("["+a+"] "+c)}}return c.enabled=function(c){return c!==a&&(b=!!c),b},c})}(),function(a){function d(a,c,d){var e=b[a];return!e||!e.validate?c:e.validate(c)}var b={baseDir:{name:"{{baseDir}}",defaultValue:"./",validate:function(a){return a.replace(/\/?$/,"/")}}};c("core/config",[],function(){function c(e){function h(b){var c=g.length;while(c--)if(g[c].value(b)!==a)return g[c];return f}function i(d,e){if(d===a)return d;var f=d,g,i,j,k;for(var l in b)b.hasOwnProperty(l)&&(g=b[l],k=h(l),i=k instanceof c?k.value(l):k[l],j=i?i:g.defaultValue,f=f.replace?f.replace(g.name,j,"g"):f);return f}function j(b,c){if(b===a)return b;for(var d in b)b.hasOwnProperty(d)&&(typeof b[d]=="object"?b[d]=j(b[d],c):b[d]=i(b[d],c));return b}if(typeof e!="object")throw"Config Error: expected parsed config object";var f=e,g=[];this.value=function(b,e){var f=h(b);return f instanceof c?f.value(b,e):(e!==a&&(f[b]=d(b,e,f)),typeof f[b]=="object"?j(f[b],f):i(f[b],f))},this.merge=function(a){g.push(a)}}var e={parse:function(a){var b;try{return b=JSON.parse(a),new c(b)}catch(d){throw"Config.parse Error: unable to parse config string. Error was: "+d.message}}};return e})}(),c("util/dragndrop",[],function(){function o(){k=!1;if(g){for(var b=h.length-1;b>=0;--b)h[b].update();window.setTimeout(o,a)}}function p(b){j[0]=i[0],j[1]=i[1],i=[b.clientX,b.clientY];var c=[],d,e,k,l;if(g)for(k=h.length-1;k>=0;--k)c.push(h[k]);else{var m;g=!0,window.setTimeout(o,a);for(k=h.length-1;k>=0;--k)m=h[k],m.start(b),c.push(h[k])}for(k=c.length-1;k>=0;--k){e=c[k];for(l=f.length-1;l>=0;--l)d=f[l],!d.element.id||e.element.id===d.element.id||!d.drag(e.element.getBoundingClientRect())?d.forget(e):d.remember(e)}}function q(a){g=!1,window.removeEventListener("mousemove",p,!1);var b;for(var c=h.length-1;c>=0;--c)b=h[c],b.dragging&&b.stop()}function r(a){if(a.which!==1)return;a.preventDefault(),a.stopPropagation(),window.addEventListener("mousemove",p,!1),window.addEventListener("mouseup",q,!1)}function s(a){var b=getComputedStyle(a),c=b.getPropertyValue("padding-top"),d=b.getPropertyValue("padding-left"),e=b.getPropertyValue("padding-bottom"),f=b.getPropertyValue("padding-right");return{top:Number(c.substring(0,c.indexOf("px"))),left:Number(d.substring(0,d.indexOf("px"))),bottom:Number(e.substring(0,e.indexOf("px"))),right:Number(f.substring(0,f.indexOf("px")))}}function t(){return{top:0,left:0,right:window.innerWidth,bottom:window.innerHeight}}function u(a,b){var c=b.parentNode;while(c){if(c===a)return!0;c=c.parentNode}return!1}function v(a){var b=getComputedStyle(a).zIndex;if(isNaN(b)){b=0;var c=a.parentNode;while(c&&[window,document].indexOf(c)===-1){var d=getComputedStyle(c);if(d){var e=d.zIndex;isNaN(e)&&e>b&&(b=e)}c=c.parentNode}}}function w(){f=f.sort(function(a,b){var c=a.element,d=b.element,e=v(c),f=v(d);return u(c,d)?-1:u(d,c)?1:e-f})}function x(d,f){function o(f){function s(){var a=q-p,f=h+a,i=o-a;if(i<e)return;l&&l.scrollLeft>0&&g.left+a<m.left-c&&(l.scrollLeft-=b,f-=b,i+=b,p+=b),f<0&&(i+=f,f=0),d.style.left=f+"px",d.style.width=i+"px",n=d.getBoundingClientRect()}function t(a){window.removeEventListener("mousemove",u,!1),window.removeEventListener("mouseup",t,!1),clearInterval(k),k=-1,j()}function u(b){q=b.clientX,k===-1&&(k=setInterval(s,a),i())}f.stopPropagation();var g=d.getBoundingClientRect(),h=d.offsetLeft,o=d.offsetWidth,p=f.clientX,q,r;n=d.getBoundingClientRect(),r=f.clientX-n.left,m=l.getBoundingClientRect(),window.addEventListener("mousemove",u,!1),window.addEventListener("mouseup",t,!1)}function p(f){function r(){var a=p-o,f=h+a;if(f<e)return;l&&l.scrollLeft<l.scrollWidth-m.width&&p>m.right+c&&(l.scrollLeft+=b,o-=b),f+g>d.offsetParent.offsetWidth&&(f=d.offsetParent.offsetWidth-g),d.style.width=f+"px",n=d.getBoundingClientRect()}function s(a){window.removeEventListener("mousemove",t,!1),window.removeEventListener("mouseup",s,!1),clearInterval(k),k=-1,j()}function t(b){p=b.clientX,k===-1&&(k=setInterval(r,a),i())}f.stopPropagation();var g=d.offsetLeft,h=d.offsetWidth,o=f.clientX,p,q;n=d.getBoundingClientRect(),l&&(m=l.getBoundingClientRect()),q=f.clientX-n.left,window.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",s,!1)}var g=document.createElement("div"),h=document.createElement("div"),i=f.start||function(){},j=f.stop||function(){},k=-1,l=f.scroll,m,n;return g.className="handle left-handle",h.className="handle right-handle",d.appendChild(g),d.appendChild(h),g.addEventListener("mousedown",o,!1),h.addEventListener("mousedown",p,!1),{destroy:function(){g.removeEventListener("mousedown",o,!1),h.removeEventListener("mousedown",p,!1),d.removeChild(g),d.removeChild(h)}}}function y(a,b){var c=b.image,d=b.start||function(){},e=b.stop||function(){},f=l.length;l[f]=a,a.setAttribute("draggable",!0),a.addEventListener("dragstart",function(b){m=a,b.dataTransfer.effectAllowed="all",b.dataTransfer.setData("text",f);if(c){var e=document.createElement("img");e.src=c.src,b.dataTransfer.setDragImage(e,e.width/2,e.height/2)}d()}),a.addEventListener("dragend",function(a){m=null,e()}),a.addEventListener("drop",function(a){})}function z(a,b){function n(b){b.preventDefault(),b.stopPropagation(),c&&a.classList.remove(c);var e=b.dataTransfer.getData("text"),f=l[e]||m;f&&d(f,[b.clientX,b.clientY])}function o(a){a.preventDefault(),a.stopPropagation(),a.dataTransfer.dropEffect="copy"}function p(b){c&&a.classList.add(c);var d=b.dataTransfer.getData("text"),f=l[d]||m;f&&e(f,[b.clientX,b.clientY])}function q(b){c&&a.classList.remove(c);var d=b.dataTransfer.getData("text"),e=l[d]||m;e&&g(e,[b.clientX,b.clientY])}b=b||{};var c=b.hoverClass,d=b.drop||function(){},e=b.over||function(){},g=b.out||function(){},h={},j={},k=0;return a.addEventListener("drop",n,!1),a.addEventListener("dragover",o,!1),a.addEventListener("dragenter",p,!1),a.addEventListener("dragleave",q,!1),h={element:a,remember:function(b){!j[b.element.id]&&!b.droppable&&(k++,a.classList.add(c),j[b.element.id]=b,b.droppable=h,e(b.element))},forget:function(b){j[b.element.id]&&b.droppable&&(--k===0&&a.classList.remove(c),b.droppable=null,g(b.element),delete j[b.element.id])},drop:function(b){j[b.element.id]&&(--k===0&&a.classList.remove(c),b.droppable=null,d(b.element,i),delete j[b.element.id])},drag:function(b){var c=a.getBoundingClientRect(),d=Math.max(b.left,c.left),e=Math.max(b.top,c.top),f=Math.min(b.right,c.right),g=Math.min(b.bottom,c.bottom);if(f<d||g<e)return!1;var h=[f-d,g-e];return h[0]*h[1]/2>b.width*b.height/4?!0:!1},destroy:function(){var b=f.indexOf(h);b>-1&&f.splice(b,1),a.removeEventListener("drop",n,!1),a.removeEventListener("dragover",o,!1),a.removeEventListener("dragenter",p,!1),a.removeEventListener("dragleave",q,!1)}},f.push(h),w(),h}function A(a,e){function F(){var b=i[0]-m[0],c=i[1]-m[1];if(!j||j.indexOf("x")>-1)a.style.left=b-u.left+"px";if(!j||j.indexOf("y")>-1)a.style.top=c-u.top+"px";p=a.getBoundingClientRect()}function G(){k||(p.right>q.right+c?(k=!0,g.scrollLeft+=w):p.left<q.left-c&&(k=!0,g.scrollLeft-=w)),C.updateRects()}function H(){var b=p.left,d=p.top,e=b+p.width,f=d+p.height;if(!j||j.indexOf("y")>-1)d<v.top?d=v.top:f>v.bottom&&(d=v.bottom-p.height),a.style.top=d-u.top-E.top+"px";if(!j||j.indexOf("x")>-1)e>q.right+c?(b=q.right+c-p.width,e=b+p.width):b<q.left-c&&(b=q.left-c,e=b+p.width),b<v.left?b=v.left:e>v.right&&(b=v.right-p.width),a.style.left=b-u.left-E.left+"px";p=a.getBoundingClientRect()}e=e||{};var f=e.containment,g=e.scroll,j=e.axis,l=e.revert,m,o=a,p,q,u,v,w=e.scrollAmount||b,x,y=e.start||function(){},z=e.stop||function(){return!1},A,B=null,C={destroy:function(){C.selected=!1,a.removeEventListener("mousedown",r,!1)}},D=!1,E=n;return f&&(E=s(f)),C.updateRects=function(){v=f?f.getBoundingClientRect():t(),u=a.offsetParent?a.offsetParent.getBoundingClientRect():v,q=g?g.getBoundingClientRect():v,p=a.getBoundingClientRect()},a.addEventListener("mousedown",r,!1),C.update=function(){F(),g&&G(),H()},C.start=function(b){D=!0,A=[a.offsetLeft,a.offsetTop],C.updateRects(),m=[b.clientX-p.left,b.clientY-p.top],y()},C.stop=function(){D=!1,z(),!B&&l?(a.style.left=A[0]+"px",a.style.top=A[1]+"px"):B&&B.drop(C)},Object.defineProperties(C,{selected:{enumerable:!0,get:function(){for(var a=h.length-1;a>=0;--a)if(h[a].element.id===o.id)return!0;return!1},set:function(b){if(b)x=getComputedStyle(a).getPropertyValue("z-index"),a.style.zIndex=d,h.push(C);else{a.style.zIndex=x;for(var c=h.length-1;c>=0;--c)if(h[c].element.id===o.id){h.splice(c,1);return}}}},dragging:{enumerable:!0,get:function(){return D}},element:{enumerable:!0,get:function(){return o}},droppable:{enumerable:!0,get:function(){return B},set:function(a){B=a}}}),C}function B(a,b){function n(b){var c=b.cloneNode(!1);return c.classList.add("placeholder"),a.replaceChild(c,b),c}function o(a){h.style.top=i-a+"px"}function p(b){if(!j)j=!0,l=n(h),a.appendChild(h),h.style.position="absolute",h.style.zIndex=d,o(0);else{var f=g-b.clientY;o(f);var i=h.getBoundingClientRect();for(var m=e.length-1;m>=0;--m){var p=e[m];if(p===h)continue;var q=p.getBoundingClientRect(),r=Math.max(i.left,q.left),s=Math.max(i.top,q.top),t=Math.min(i.right,q.right),u=Math.min(i.bottom,q.bottom);if(t<r||u<s)continue;var v=[t-r,u-s];if(v[0]*v[1]/2>i.width*i.height/4){k=p;var w=n(k);a.replaceChild(k,l),l=w;var x=[],y=a.childNodes;for(var z=0,A=y.length;z<A;++z){var B=y[z];B!==h&&(B!==l?x.push(B):x.push(h))}c(x)}}}}function q(a){if(a.which!==1)return;j=!1,h=this,i=h.offsetTop;var b=getComputedStyle(h);m=b.getPropertyValue("z-index"),g=a.clientY,window.addEventListener("mouseup",r,!1),window.addEventListener("mousemove",p,!1)}function r(b){h.style.zIndex=m,window.removeEventListener("mouseup",r,!1),window.removeEventListener("mousemove",p,!1),j=!1,l&&(h.style.zIndex="",h.style.position="",h.style.top="",a.replaceChild(h,l),l=null)}var c=b.change||function(){},e=[],f={},g=0,h,i,j,k,l,m;return f.addItem=function(a){e.push(a),a.addEventListener("mousedown",q,!1)},f.removeItem=function(a){e.splice(e.indexOf(a),1),a.removeEventListener("mousedown",q,!1)},f}var a=16,b=10,c=20,d=2147483647,e=15,f=[],g=!1,h=[],i=[0,0],j=[0,0],k=!1,l=[],m,n={top:0,left:0,bottom:0,right:0};return{draggable:A,droppable:z,helper:y,resizable:x,sortable:B}}),c("ui/position-tracker",[],function(){var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();return function(b,c){function f(){var a=b.getBoundingClientRect();if(a.left!==d.left||a.top!==d.top)d={left:a.left,top:a.top,width:a.width,height:a.height},document.body.scrollTop<0&&(d.top+=document.body.scrollTop),c(d)}function g(){f(),e||a(g)}var d={},e=!1;return g(),window.addEventListener("scroll",f,!1),{destroy:function(){e=!0,window.removeEventListener("scroll",f,!1)}}}}),c("ui/page-element",["core/logger","core/eventmanager","util/dragndrop","ui/position-tracker"],function(a,b,c,d){var e=function(){};return function(a,f,g){function r(){i.classList.remove("blink"),!p&&!o&&(i.style.visibility="hidden"),o||(i.classList.remove("on"),q.blink=l)}var h=typeof a=="string"?document.getElementById(a):a,i=document.createElement("div"),j=f||{},k=g||{},l,m,n,o=!1,p=!1,q=this;b(q),m=d(h,function(a){i.style.left=a.left+"px",i.style.top=a.top+"px",i.style.width=a.width+"px",i.style.height=a.height+"px",q.dispatch("moved",a)}),this.highlight=function(a){a?(q.blink=e,o=!0,i.style.visibility="visible",i.classList.add("on"),i.classList.remove("blink")):(q.blink=l,o=!1,i.classList.remove("on"),p||(i.style.visibility="hidden"))},window.addEventListener("dragstart",function(a){i.style.visibility="visible",p=!0},!1),window.addEventListener("dragend",function(a){i.classList.contains("blink")||(i.style.visibility="hidden"),p=!1},!1),this.destroy=function(){m.destroy(),i.parentNode&&i.parentNode.removeChild(i),n&&n.destroy()},i.className="butter-highlight ",i.setAttribute("data-butter-exclude","true"),k.highlightClass&&(i.className+=k.highlightClass),i.style.visibility="hidden",this.blink=l=function(){q.blink=e,i.classList.add("on"),setTimeout(function(){i.classList.add("blink","true")},0),i.style.visibility="visible",setTimeout(r,1500)},h&&(document.body.appendChild(i),h.setAttribute("butter-clean","true"),n=c.droppable(i,{over:function(a){if(a.getAttribute("data-butter-draggable-type")!=="plugin")return;q.highlight(!0),j.over&&j.over()},out:function(a){if(a.getAttribute("data-butter-draggable-type")!=="plugin")return;q.highlight(!1),j.out&&j.out()},drop:function(a){if(a.getAttribute("data-butter-draggable-type")!=="plugin")return;q.highlight(!1),j.drop&&j.drop(a)}})),this.highlightElement=i,Object.defineProperties(this,{element:{enumerable:!0,get:function(){return h}}})}}),function(){c("core/target",["core/logger","core/eventmanager","ui/page-element"],function(a,b,c){var d=0,e=function(e){e=e||{};var f="Target"+d++,g=new a(f),h=e.name||f,i=e.element,j,k=this;b(k),typeof i=="string"&&(i=document.getElementById(i)),i?j=new c(i,{drop:function(a){k.dispatch("trackeventrequested",{element:a,target:k})}},{highlightClass:"butter-target-highlight"}):g.log("Warning: Target element is null."),this.destroy=function(){j&&j.destroy()},Object.defineProperties(this,{view:{enumerable:!0,get:function(){return j}},name:{enumerable:!0,get:function(){return h}},id:{enumerable:!0,get:function(){return f}},elementID:{enumerable:!0,get:function(){if(i)return i.id}},element:{enumerable:!0,get:function(){return i}},isDefault:{enumerable:!0,get:function(){return i&&i.hasAttribute("data-butter-default")?!0:!1}},json:{enumerable:!0,get:function(){var a="";return i&&i.id&&(a=i.id),{id:f,name:h,element:a}},set:function(a){a.name&&(h=a.name),a.element&&(i=document.getElementById(a.element))}}})};return e})}(),c("util/time",[],function(){function b(b){return Math.round(b*Math.pow(10,a))/Math.pow(10,a)}var a=3,c={roundTime:b};return Object.defineProperties(c,{timeAccuracy:{enumerable:!0,get:function(){return a},set:function(b){a=b}}}),c}),c("core/views/trackevent-view",["core/logger","core/eventmanager","util/dragndrop"],function(a,b,c){var d=0;return function(a,e,f){function u(a){n[0].style.visibility=a?"visible":"hidden",n[1].style.visibility=a?"visible":"hidden"}function v(){h.style.left=k*i+"px",h.style.width=(l-k)*i+"px"}function w(){h.style.top="0px";var a=h.getClientRects()[0];k=h.offsetLeft/i,l=k+a.width/i,r.update({start:k,end:l})}function x(){p.selected=!0,h.setAttribute("selected",!0)}function y(){p.selected=!1,h.removeAttribute("selected")}var g="TrackEventView"+d++,h=document.createElement("div"),i=1,j=e,k=f.start||0,l=f.end||k+1,m,n,o=document.createElement("div"),p,q,r=a,s=!1,t=this;b(t),h.appendChild(o),this.setToolTip=function(a){h.title=a},this.update=function(a){a=a||{},h.style.top="0px",isNaN(a.start)||(k=a.start),isNaN(a.end)||(l=a.end),v()},Object.defineProperties(this,{trackEvent:{enumerable:!0,get:function(){return r}},element:{enumerable:!0,get:function(){return h}},start:{enumerable:!0,get:function(){return k},set:function(a){k=a,v()}},end:{enumerable:!0,get:function(){return l},set:function(a){l=a,v()}},type:{enumerable:!0,get:function(){return j},set:function(a){j=a,o.innerHTML=j,h.setAttribute("data-butter-trackevent-type",j)}},selected:{enumerable:!0,get:function(){return p.selected},set:function(a){a?x():y()}},dragging:{enumerable:!0,get:function(){return s}},zoom:{enumerable:!0,get:function(){return i},set:function(a){i=a,v()}},id:{enumerable:!0,configurable:!1,get:function(){return g}},parent:{enumerabled:!0,get:function(){return m},set:function(a){m=a,p&&(p.destroy(),p=null),q&&(u(!1),q.destroy(),q=null,n=null),m&&(m.element&&m.element.parentNode&&m.element.parentNode.parentNode&&(p=c.draggable(h,{containment:m.element.parentNode,scroll:m.element.parentNode.parentNode,start:function(){s=!0,t.dispatch("trackeventdragstarted")},stop:function(){s=!1,t.dispatch("trackeventdragstopped"),w()},revert:!0}),p.selected=r.selected,q=c.resizable(h,{containment:m.element.parentNode,scroll:m.element.parentNode.parentNode,stop:w}),h.setAttribute("data-butter-draggable-type","trackevent"),h.setAttribute("data-butter-trackevent-id",r.id),n||(n=h.querySelectorAll(".handle"),n&&n.length===2&&(h.addEventListener("mouseover",function(a){u(!0)},!1),h.addEventListener("mouseout",function(a){u(!1)},!1),u(!1)))),v())}}}),h.className="butter-track-event",t.type=j,h.id=g,t.update(f),h.addEventListener("mousedown",function(a){t.dispatch("trackeventmousedown",{originalEvent:a,trackEvent:r})},!0),h.addEventListener("mouseup",function(a){t.dispatch("trackeventmouseup",{originalEvent:a,trackEvent:r})},!1),h.addEventListener("mouseover",function(a){t.dispatch("trackeventmouseover",{originalEvent:a,trackEvent:r})},!1),h.addEventListener("mouseout",function(a){t.dispatch("trackeventmouseout",{originalEvent:a,trackEvent:r})},!1),h.addEventListener("dblclick",function(a){t.dispatch("trackeventdoubleclicked",{originalEvent:a,trackEvent:r})},!1),h.addEventListener("click",function(a){t.dispatch("trackeventclicked",{originalEvent:a,trackEvent:r})},!1)}}),c("core/views/track-view",["core/logger","core/eventmanager","util/dragndrop"],function(a,b,c){var d=0;return function(a){function o(){m=c.droppable(j,{hoverClass:"draggable-hover",drop:function(a,b){var c=a.getAttribute("data-butter-draggable-type"),d,e,h=j.getBoundingClientRect();c==="plugin"?(e=b[0]-h.left,d=e/h.width*k,g.dispatch("plugindropped",{start:d,track:f,type:a.getAttribute("data-popcorn-plugin-type")})):c==="trackevent"&&a.parentNode!==j&&(e=a.offsetLeft,d=e/h.width*k,g.dispatch("trackeventdropped",{start:d,track:f,trackEvent:a.getAttribute("data-butter-trackevent-id")}))}})}function p(){j.style.width=k*n+"px"}var e="TrackView"+d++,f=a,g=this,h=[],i=[],j=document.createElement("div"),k=1,l,m,n=1;b(g),j.className="butter-track",j.id=e,Object.defineProperties(this,{element:{enumerable:!0,configurable:!1,get:function(){return j}},zoom:{enumerable:!0,get:function(){return n},set:function(a){n=a,p();for(var b=0,c=h.length;b<c;++b)h[b].zoom=n}},duration:{enumerable:!0,get:function(){return k},set:function(a){k=a,p();for(var b=0,c=h.length;b<c;++b)h[b].update()}},parent:{enumerable:!0,get:function(){return l},set:function(a){l=a,m&&(m.destroy(),m=null),l&&o();for(var b=0,c=h.length;b<c;++b)h[b].parent=g}}}),this.addTrackEvent=function(a){var b=a.view.element;j.appendChild(b),h.push(a.view),i.push(a.view.element),a.view.zoom=n,a.view.parent=g,g.chain(a,["trackeventmousedown","trackeventmouseover","trackeventmouseout"])},this.removeTrackEvent=function(a){var b=a.view.element;j.removeChild(b),h.splice(h.indexOf(a.view),1),i.splice(h.indexOf(a.view.element),1),a.view.parent=null,g.unchain(a,["trackeventmousedown","trackeventmouseover","trackeventmouseout"])}}}),c("util/uri",[],function(){function a(b){var c=a.options,d=c.parser[c.strictMode?"strict":"loose"].exec(b),e={},f=14;while(f--)e[c.key[f]]=d[f]||"";return e[c.q.name]={},e[c.key[12]].replace(c.q.parser,function(a,b,d){b&&(e[c.q.name][b]=d)}),e}function d(a){var b="";return b+=a.protocol?a.protocol+"://":"",b+=a.authority||"",b+=a.path||"",b+=a.query?"?"+a.query:"",b+=a.anchor?"#"+a.anchor:"",b}a.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var b="butteruid",c=Date.now(),e={set seed(a){c=a|0},get seed(){return c},parse:function(b){var c=a(b);return c.toString=function(){return d(this)},c},makeUnique:function(a){var d,e,f,g="",h=0;typeof a=="string"&&(a=this.parse(a)),f=a.queryKey,f[b]=c++;for(d in f)f.hasOwnProperty(d)&&(e=f[d],g+=h>0?"&":"",g+=d,g+=!e&&e!==0?"":"="+e,h++);return a.query=g,a}};return e}),c("core/popcorn-wrapper",["core/logger","core/eventmanager","util/uri"],function(a,b,c){var d=/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu|vimeo|soundcloud|baseplayer)/,e=100,f=1e4,g=1e4;return function(b,h){function v(){for(var a in k)k.hasOwnProperty(a)&&q.on(a,k[a])}function w(a){var b=d.exec(a);return b?(r=b[1],r==="youtu"&&(r="youtube")):r="object",r}function x(a){var b=document.getElementById(a);if(r!=="object"&&b&&["VIDEO","AUDIO"].indexOf(b.nodeName)!==-1){var c=b.parentNode,d=document.createElement("div"),e=["controls","preload","autoplay","loop","muted","poster","src"],f;d.id=b.id,f=b.attributes;if(f)for(var g=f.length-1;g>=0;g--){var h=f[g].nodeName;e.indexOf(h)===-1&&d.setAttribute(h,b.getAttribute(h))}b.className&&(d.className=b.className),c.replaceChild(d,b),d.setAttribute("data-butter","media")}}function z(a){var b=new Function("",a),c=b();if(!c){var d=document.createElement("script");d.innerHTML=a,document.head.appendChild(d),c=window.Popcorn.instances[window.Popcorn.instances.length-1]}q=c}function A(a,b,c,d){function i(){if(f)return;a()?(h=!0,b()):setTimeout(i,e)}var f=!1,h=!1;setTimeout(function(){h||(f=!0,c())},g),i()}function B(a,b){A(function(){return q&&q.media.readyState>=1&&q.duration()>0},a,b,g)}function C(a,b){r!=="object"?(o(r),A(function(){return!!window.Popcorn[r]},a,b,f)):a()}var i=b,j=new a(i+"::PopcornWrapper"),k=h.popcornEvents||{},l=h.prepare||function(){},m=h.constructing||function(){},n=h.fail||function(){},o=h.playerTypeRequired||function(){},p=h.timeout||function(){},q,r,s={},t=!1,u=this;this.unbind=function(){try{q.destroy(),q=undefined}catch(a){j.log("WARNING: Popcorn did NOT get destroyed properly: \n"+a.message+"\n"+a.stack)}},this.interruptLoad=function(){t=!0},this.updateEvent=function(a){var b=a.popcornOptions,c=a.id,d=s[c],e=null;q&&(d&&q.getTrackEvent(d)&&q.removeTrackEvent(d),q[a.type]&&(q[a.type](b),s[c]=q.getLastTrackEventId(),e=q.getTrackEvent(s[c]),a.popcornTrackEvent=e,a.view&&(e.toString?a.view.setToolTip(e.toString()):a.view.setToolTip(JSON.stringify(b)))))},this.destroyEvent=function(a){var b=a.id,c=s[b];q&&(c&&q.getTrackEvent(c)&&q.removeTrackEvent(c),delete s[b])},this.prepare=function(a,b,c,d,e){function g(a){t=!0,p(a)}function h(a){t=!0,j.log(a),n(a)}var f,i=a;if(typeof a!="string"){if(!a.length)throw"URL is invalid: empty array or not a string.";i=a[0]}else a.indexOf(",")>-1&&(f=a.split(","),i=f[0],a=f);w(i);if(!b){j.log("Warning: tried to prepare media with null target.");return}if(!q)try{C(function(){x(b),z(y(c,a,b,null,d,e)),v(),m&&m(),B(l,g)},g)}catch(k){h(k)}};var y=this.generatePopcornString=function(a,b,d,e,f,g,h){f=f||{},g=g||{};var i="",k,l,m,n;b=typeof b=="string"?[b]:b;for(m=0;m<b.length;m++)b[m]=c.makeUnique(b[m]).toString();b=JSON.stringify(b),a?a=", "+JSON.stringify(a):a=", {}",typeof d!="string"&&(d&&d.id?d=d.id:j.log("WARNING: Unexpected non-string Popcorn target: "+d));if(!r)throw new Error("Media type not generated yet. Please specify a url for media objects before generating a popcorn string.");g.init&&(i+=g.init+"\n"),f.init&&(i+=f.init+"();\n"),r==="baseplayer"?i+="Popcorn.player( 'baseplayer' );\nvar popcorn = Popcorn.baseplayer( '#"+d+"' "+a+" );\n":i+="var popcorn = Popcorn.smart( '#"+d+"', "+b+a+" );\n",g.beforeEvents&&(i+=g.beforeEvents+"\n"),f.beforeEvents&&(i+=f.beforeEvents+"( popcorn );\n");if(q&&h)for(m=h.length-1;m>=0;m--){a=h[m].popcornOptions,l={};for(n in a)a.hasOwnProperty(n)&&a[n]!==undefined&&(l[n]=a[n]);try{k=JSON.stringify(l,null,4)}catch(o){k=!1,j.log("WARNING: Unable to export event options: \n"+o.message)}k&&(i+="popcorn."+h[m].type+"("+k+");\n")}return g.afterEvents&&(i+=g.afterEvents+"\n"),f.afterEvents&&(i+=f.afterEvents+"( popcorn );\n"),i+="popcorn.controls( true );\n",e=e||"inline",e==="event"?(i="\ndocument.addEventListener('DOMContentLoaded',function(e){\n"+i,i+="\n},false);"):i+="\nreturn popcorn;",i};this.play=function(){q.play()},this.pause=function(){q.pause()},this.clear=function(a){typeof a=="string"&&(a=document.getElementById(a));if(!a){j.log("Warning: tried to clear media with null target.");return}q&&u.unbind();while(a.firstChild)a.removeChild(a.firstChild);["AUDIO","VIDEO"].indexOf(a.nodeName)>-1&&(a.currentSrc="",a.src="",a.removeAttribute("src"))},Object.defineProperties(this,{volume:{enumerable:!0,set:function(a){q&&q.volume(a)},get:function(){return q?q.volume():!1}},muted:{enumerable:!0,set:function(a){q&&(a?q.mute():q.unmute())},get:function(){return q?q.muted():!1}},currentTime:{enumerable:!0,set:function(a){q&&q.currentTime(a)},get:function(){return q?q.currentTime():0}},duration:{enumerable:!0,get:function(){return q?q.duration():0}},popcorn:{enumerable:!0,get:function(){return q}},paused:{enumerable:!0,get:function(){return q?q.paused():!0},set:function(a){q&&(a?q.pause():q.play())}}})}}),c("ui/logo-spinner",[],function(){return function(a){var b=document.createElement("div"),c=document.createElement("div");return b.className="butter-logo-spin-outer",c.className="butter-logo-spin-inner",b.appendChild(c),a&&a.appendChild(b),{element:b,start:function(){b.classList.remove("fade-out"),c.classList.add("active")},stop:function(a){b.classList.add("fade-out"),setTimeout(function(){c.classList.remove("active"),a&&a()},500)}}}}),c("ui/widget/textbox",[],function(){function a(b){var c=b.target;c.select(),c.removeEventListener("focus",a,!1)}function b(a){a.preventDefault();var c=a.target;c.removeEventListener("mouseup",b,!1)}function c(c){c.addEventListener("focus",a,!1),c.addEventListener("mouseup",b,!1)}return function(a){if(!a||a.type!=="text")throw"Textbox: Expected an input element of type text";return a.addEventListener("blur",function(a){c(a.target)},!1),c(a),a}}),c("core/page",["core/logger","core/eventmanager"],function(a,b){return function(a,c){var d="{popcorn-js}/players/{type}/popcorn.{type}.js",e;b(this),this.scrape=function(){var a=document.body,b=a.querySelectorAll("*[data-butter='target']"),c=a.querySelectorAll("*[data-butter='media']");return{media:c,target:b}},this.prepare=function(b){a.load([{type:"js",url:"{popcorn-js}/popcorn.js",check:function(){return!!window.Popcorn}},{type:"js",url:"{popcorn-js}/modules/player/popcorn.player.js",check:function(){return!!window.Popcorn&&!!window.Popcorn.player}}],b,null,!0)},this.addPlayerType=function(b,c){a.load({type:"js",url:d.replace(/\{type\}/g,b),check:function(){return!!Popcorn[b]}},c)},this.getHTML=function(a){var b,c,d,f,g,h,i,j,k,l,m;b=document.createElement("html"),e?d=e.body.cloneNode(!0):d=document.getElementsByTagName("body")[0].cloneNode(!0),c=document.getElementsByTagName("head")[0].cloneNode(!0),i=Array.prototype.slice.call(c.querySelectorAll("*[data-butter-exclude]")),i=i.concat(Array.prototype.slice.call(c.querySelectorAll("*[data-requiremodule]")));for(f=0,g=i.length;f<g;++f)j=i[f],j.parentNode.removeChild(j);m=d.querySelectorAll("*[data-butter='media']");for(f=0,g=m.length;f<g;++f)j=m[f],k=document.getElementById(j.id).cloneNode(!0),["VIDEO","AUDIO"].indexOf(k.nodeName)===-1&&(k.innerHTML=""),j.parentNode.replaceChild(k,j),k.removeAttribute("data-butter-source");h=d.querySelectorAll('*[butter-clean="true"]');for(f=0,g=h.length;f<g;++f)j=h[f],j.removeAttribute("butter-clean"),j.removeAttribute("data-butter"),j.removeAttribute("data-butter-default"),j.classList?j.classList.remove("ui-droppable"):j.className=j.className.replace(/ui-droppable/g,"");i=d.querySelectorAll("*[data-butter-exclude]");for(f=0,g=i.length;f<g;++f)j=i[f],j.parentNode.removeChild(j);l=document.createElement("base"),l.href=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1),c.insertBefore(l,c.firstChild),b.appendChild(c),b.appendChild(d);if(a)for(f=0;f<a.length;++f){var n=document.createElement("script");n.type="text/javascript",n.innerHTML="(function(){\n"+a[f]+"\n}());",d.appendChild(n)}return this.dispatch("getHTML",b),"<html>"+b.innerHTML+"</html>"},this.snapshotHTML=function(){e={head:document.getElementsByTagName("head")[0].cloneNode(!0),body:document.getElementsByTagName("body")[0].cloneNode(!0)}},this.eraseSnapshot=function(){e=null}}}),c("timeline/track-container",["core/logger","util/dragndrop"],function(a,b){return function(a,c){function l(){h.style.width=d.duration*e+"px"}function m(a){var b=a.data.view;h.appendChild(b.element),b.duration=d.duration,b.zoom=e,b.parent=f,j&&j.update()}var d=c,e=1,f=this,g=document.createElement("div"),h=document.createElement("div"),i,j,k;g.appendChild(h),g.className="tracks-container-wrapper",h.className="tracks-container",h.addEventListener("mousedown",function(a){f.deselectOthers()},!1),k=b.droppable(g,{drop:function(b,c){if(b.getAttribute("data-butter-draggable-type")==="plugin"){var d=a.currentMedia.addTrack(),e=d.view.element.getBoundingClientRect(),f=c[0]-e.left,g=f/e.width*d.view.duration;d.view.dispatch("plugindropped",{start:g,track:d,type:b.getAttribute("data-popcorn-plugin-type")})}}}),this.setScrollbars=function(a,b){i=a,j=b,j.update()},this.orderTracks=function(a){for(var b=0,c=a.length;b<c;++b){var d=a[b].view.element;d!==h.childNodes[b]&&(a[b].order=b,h.insertBefore(d,h.childNodes[b+1]))}},this.deselectOthers=function(){for(var b=0;b<a.selectedEvents.length;b++)a.selectedEvents[b].selected=!1;return a.selectedEvents=[],f},d.listen("mediaready",function(){l();var a=d.tracks;for(var b=0,c=a.length;b<c;++b){var g=a[b].view;h.appendChild(g.element),g.duration=d.duration,g.zoom=e,g.parent=f}}),a.listen("mediaremoved",function(a){a.data===d&&k&&k.destroy()});var n=d.tracks;for(var o=0;o<n.length;++o)m({data:n[o]});d.listen("trackadded",m),d.listen("trackremoved",function(a){var b=a.data.view;h.removeChild(b.element),j&&j.update()}),f.update=function(){l()},f.snapTo=function(a){var b=a/d.duration,c=h.clientWidth*b,e=h.clientWidth-g.clientWidth;if(c<g.scrollLeft||c>g.scrollLeft+g.clientWidth){if(c>e){g.scrollLeft=e;return}g.scrollLeft=c}},Object.defineProperties(this,{zoom:{enumerable:!0,get:function(){return e},set:function(a){e=a,l();var b=d.tracks;for(var c=0,f=b.length;c<f;++c)b[c].view.zoom=e}},element:{enumerable:!0,get:function(){return g}},container:{enumerable:!0,get:function(){return h}}})}}),c("timeline/scrollbars",["core/eventmanager"],function(a){function c(c,d){function o(){k=g.getBoundingClientRect().height,j=e.getBoundingClientRect().height,l=j-(h.scrollHeight-k)/b,l=Math.max(20,Math.min(j,l)),f.style.height=l+"px",s()}function p(){window.removeEventListener("mouseup",p,!1),window.removeEventListener("mousemove",q,!1),f.addEventListener("mousedown",r,!1)}function q(a){var b=a.pageY-m;b=Math.max(0,Math.min(b,j-l)),f.style.top=b+"px";var c=f.offsetTop/(j-l);g.scrollTop=(h.scrollHeight-k)*c,n.dispatch("scroll",g.scrollTop)}function r(a){if(a.button===0){var b=f.offsetTop;m=a.pageY-b,window.addEventListener("mouseup",p,!1),window.addEventListener("mousemove",q,!1),f.removeEventListener("mousedown",r,!1)}}function s(){h.scrollHeight-j>0?f.style.top=(j-l)*(g.scrollTop/(h.scrollHeight-k))+"px":f.style.top="0px"}var e=document.createElement("div"),f=document.createElement("div"),g=c.element,h=c.container,i=d||g,j,k,l,m=0,n=this;a(n),e.className="scroll-bar scroll-bar-v",f.className="scroll-handle",e.appendChild(f),this.update=function(){o()},g.addEventListener("scroll",function(a){s()},!1),i.addEventListener("mousewheel",function(a){a.wheelDeltaY&&(g.scrollTop-=a.wheelDeltaY,s(),a.preventDefault())},!1),i.addEventListener("DOMMouseScroll",function(a){a.axis===a.VERTICAL_AXIS&&!a.shiftKey&&(g.scrollTop+=a.detail*2,s(),a.preventDefault())},!1),e.addEventListener("click",function(a){if(a.srcElement===f||a.button>0)return;var b=a.pageY,c=f.getBoundingClientRect(),d=e.getBoundingClientRect(),i;b>c.bottom?f.style.top=b-d.top-l+"px":b<c.top&&(f.style.top=b-d.top+"px"),i=f.offsetTop/(j-l),g.scrollTop=(h.scrollHeight-j)*i},!1),window.addEventListener("resize",o,!1),f.addEventListener("mousedown",r,!1),o(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return e}}})}function d(b,c){function p(){j=f.getBoundingClientRect().width,k=g.getBoundingClientRect().width,i=d.getBoundingClientRect().width,l=g.scrollWidth,m=i-(l-j),m=Math.max(20,Math.min(i,m)),e.style.width=m+"px",t()}function q(){window.removeEventListener("mouseup",q,!1),window.removeEventListener("mousemove",r,!1),e.addEventListener("mousedown",s,!1)}function r(a){var b=a.pageX-n;b=Math.max(0,Math.min(b,i-m)),e.style.left=b+"px";var c=e.offsetLeft/(i-m);f.scrollLeft=(l-i)*c,o.dispatch("scroll",f.scrollLeft)}function s(a){if(a.button===0){var b=e.offsetLeft;n=a.pageX-b,window.addEventListener("mouseup",q,!1),window.addEventListener("mousemove",r,!1),e.removeEventListener("mousedown",s,!1)}}function t(){l-i>0?e.style.left=(i-m)*(f.scrollLeft/(l-i))+"px":e.style.left="0px"}var d=document.createElement("div"),e=document.createElement("div"),f=b.element,g=b.container,h=c||g,i,j,k,l,m,n=0,o=this;a(o),d.className="scroll-bar scroll-bar-h",e.className="scroll-handle",d.appendChild(e),f.addEventListener("scroll",function(a){t()},!1),h.addEventListener("mousewheel",function(a){a.wheelDeltaX&&(f.scrollLeft-=a.wheelDeltaX,t(),a.preventDefault())},!1),h.addEventListener("DOMMouseScroll",function(a){if(a.axis===a.HORIZONTAL_AXIS||a.axis===a.VERTICAL_AXIS&&a.shiftKey)f.scrollLeft+=a.detail*2,t(),a.preventDefault()},!1),d.addEventListener("click",function(a){if(a.srcElement===e||a.button>0)return;var b=a.pageX,c=e.getBoundingClientRect(),g=d.getBoundingClientRect(),h;b>c.right?e.style.left=b-g.left-m+"px":b<c.left&&(e.style.left=b-g.left+"px"),h=e.offsetLeft/(i-m),f.scrollLeft=(l-i)*h},!1),window.addEventListener("resize",p,!1),e.addEventListener("mousedown",s,!1),this.update=function(){p()},p(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return d}}})}var b=3;return{Vertical:c,Horizontal:d}}),c("timeline/scrubber",[],function(){var a=50,b=16,c=20,d=3;return function(e,f,g,h,i){function D(){var a=q.duration,b=q.currentTime,c=n.element,d=c.scrollLeft;if(z!==b||A!==d||B!==t){var e=b/a*o,f=e-d;e<d||e-C>j.clientWidth+d?k.style.display="none":(k.style.left=f+"px",k.style.display="block"),e<d?m.style.display="none":(e>w+d?m.style.width=w-2+"px":m.style.width=f+"px",m.style.display="block")}z=b,A=d,B=t}function E(a){if(x||y)q.play(),y=!1;clearInterval(u),u=-1,window.removeEventListener("mouseup",E,!1),window.removeEventListener("mousemove",H,!1)}function F(a){a==="right"?u=setInterval(function(){s<v.right-d?(clearInterval(u),u=-1):(s+=c,n.element.scrollLeft+=c,G(),D())},b):u=setInterval(function(){s>v.left+d?(clearInterval(u),u=-1):(s-=c,n.element.scrollLeft-=c,G(),D())},b)}function G(){var a=s-r;a=Math.max(0,Math.min(a,w)),q.currentTime=(a+n.element.scrollLeft)/o*q.duration}function H(a){s=a.pageX,u===-1&&(s>v.right-d?F("right"):s<v.left+d&&F("left")),G(),D()}function I(a){r=a.pageX-k.offsetLeft,x&&(q.pause(),y=!0),k.removeEventListener("mousedown",I,!1),window.addEventListener("mousemove",H,!1),window.addEventListener("mouseup",E,!1)}function K(){D()}var j=document.createElement("div"),k=document.createElement("div"),l=document.createElement("div"),m=document.createElement("div"),n=h,o,p=f,q=g,r,s,t=1,u=-1,v,w,x=!1,y=!1,z=-1,A=n.element.scrollLeft,B=-1,C=0;j.className="time-bar-scrubber-container",k.className="time-bar-scrubber-node",l.className="time-bar-scrubber-line",k.title=l.title="Displays the media's current time. Drag to seek through the media.",m.className="fill-bar",k.appendChild(l),j.appendChild(m),j.appendChild(k),p.appendChild(j),e.ui.registerStateToggleFunctions("timeline",{transitionIn:function(){l.removeAttribute("data-butter-shortened")},transitionOut:function(){l.setAttribute("data-butter-shortened",!0)}}),i.listen("scroll",D);var J=this.onMouseDown=function(a){var b=a.pageX-j.getBoundingClientRect().left;q.currentTime=(b+n.element.scrollLeft)/o*q.duration,D(),I(a)};k.addEventListener("mousedown",I,!1),j.addEventListener("mousedown",J,!1),this.update=function(a,b){t=b||t,w=a,o=n.container.getBoundingClientRect().width,j.style.width=w+"px",v=j.getBoundingClientRect(),C=l.clientWidth,D()},q.listen("mediaplaying",function(a){x=!0}),q.listen("mediapause",function(a){y||(x=!1)});var L=setInterval(K,a);this.destroy=function(){clearInterval(L)}}}),c("timeline/zoombar",[],function(){var a=6;return function(b){function j(){window.removeEventListener("mouseup",j,!1),window.removeEventListener("mousemove",k,!1),d.addEventListener("mousedown",l,!1),b(d.offsetLeft/(e.width-d.clientWidth))}function k(a){var c=a.pageX-f;c=Math.max(0,Math.min(c,h-g)),d.style.left=c+"px",b(d.offsetLeft/(e.width-d.clientWidth))}function l(a){if(a.button===0){var b=d.offsetLeft;f=a.pageX-b,window.addEventListener("mouseup",j,!1),window.addEventListener("mousemove",k,!1),d.removeEventListener("mousedown",l,!1)}}var c=document.createElement("div"),d=document.createElement("div"),e,f,g,h,i=this;c.className="zoom-bar scroll-bar",d.className="scroll-handle",d.title="Change the zoom level of the timeline",c.appendChild(d),d.addEventListener("mousedown",l,!1),this.update=function(){e=c.getBoundingClientRect(),g=e.width/a,d.style.width=g+"px",h=e.width},this.zoom=function(a){i.update(),d.style.left=(e.width-d.clientWidth)*a+"px",b(d.offsetLeft/(e.width-d.clientWidth))},c.addEventListener("click",function(a){if(a.srcElement===d)return;var b=a.pageX,e=d.getBoundingClientRect(),f=c.getBoundingClientRect();b>e.right?d.style.left=b-f.left-g+"px":d.style.left=b-f.left+"px",k(a)},!1),c.addEventListener("resize",function(a){i.update()},!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return c}}})}}),c("timeline/status",[],function(){function a(a,b,c){function h(){g?f.removeAttribute("data-state"):f.setAttribute("data-state",!0)}function i(a){e.removeAttribute("data-mouse-state"),window.removeEventListener("mouseup",i,!1)}var d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=!0;d.className=a,e.className="status-button",e.title=c||"",f.className="status-button-icon",d.appendChild(e),e.appendChild(f),e.addEventListener("mousedown",function(a){e.setAttribute("data-mouse-state","depressed"),window.addEventListener("mouseup",i,!1)},!1),e.addEventListener("click",b,!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return d}},state:{enumerable:!0,get:function(){return g},set:function(a){g=a,h()}}})}function b(a){function f(a,b){if(typeof a=="string"||!isNaN(a)){if(b)try{d.currentTime=Popcorn.util.toSeconds(a)}catch(f){a=d.currentTime}var g=new Date(1970,0,1),h;g.setSeconds(a),h=g.toTimeString().substr(0,8),h>86399&&(h=Math.floor((g-Date.parse("1/1/70"))/36e5)+h.substr(2)),c.value=h}else c.value=e}var b=document.createElement("div"),c=document.createElement("input"),d=a,e=0;b.className="time-container",b.appendChild(c),c.type="text",d.listen("mediatimeupdate",function(a){f(d.currentTime,!1)}),c.addEventListener("focus",function(a){e=c.value},!1),c.addEventListener("blur",function(a){c.value!==e&&f(c.value,!0)},!1),c.addEventListener("keydown",function(a){a.which===13?c.blur():a.which===27&&(c.value=e,c.blur())},!1),f(0,!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return b}}})}return function(c){var d=c,e=document.createElement("div"),f,g,h,i=this;e.className="status-container",h=new b(d),f=new a("mute-button-container",function(a){d.muted=!d.muted},"Toggle volume on/off"),g=new a("play-button-container",function(a){d.ended?d.paused=!1:d.paused=!d.paused},"Play/Pause media"),d.listen("mediamuted",function(a){f.state=!1}),d.listen("mediaunmuted",function(a){f.state=!0}),d.listen("mediavolumechange",function(a){f.state=!d.muted}),d.listen("mediaended",function(a){g.state=!0}),d.listen("mediaplaying",function(a){g.state=!1}),d.listen("mediapause",function(a){g.state=!0}),e.appendChild(h.element),e.appendChild(g.element),i.update=function(){},i.destroy=function(){},Object.defineProperties(this,{statusElement:{enumerable:!0,get:function(){return e}},muteElement:{enumerable:!0,get:function(){return f.element}}})}}),c("util/scrollbars",["core/eventmanager"],function(a){function c(c,d){function n(){h=c.getBoundingClientRect().height,i=d.getBoundingClientRect().height,g=e.getBoundingClientRect().height,j=c.scrollHeight,k=g-(j-h)/b,k=Math.max(20,Math.min(g,k)),f.style.height=k+"px",r()}function o(){window.removeEventListener("mouseup",o,!1),window.removeEventListener("mousemove",p,!1),f.addEventListener("mousedown",q,!1)}function p(a){var b=a.pageY-l,d=g-k;b=Math.max(0,Math.min(b,d));var e=b/d;f.style.top=b+"px",c.scrollTop=(j-h)*e,m.dispatch("scroll",c.scrollTop)}function q(a){if(a.button===0){var b=f.offsetTop;l=a.pageY-b,window.addEventListener("mouseup",o,!1),window.addEventListener("mousemove",p,!1),f.removeEventListener("mousedown",q,!1)}}function r(){d.scrollHeight-g>0?f.style.top=(g-k)*(c.scrollTop/(c.scrollHeight-g))+"px":f.style.top="0px"}var e=document.createElement("div"),f=document.createElement("div"),g,h,i,j,k,l=0,m=this;a(m),e.className="scroll-bar scroll-bar-v",f.className="scroll-handle",e.appendChild(f),this.update=function(){n()},d.addEventListener("scroll",function(a){r()},!1),d.addEventListener("mousewheel",function(a){a.wheelDeltaY&&(c.scrollTop-=a.wheelDeltaY,r(),a.preventDefault())},!1),d.addEventListener("DOMMouseScroll",function(a){a.axis===a.VERTICAL_AXIS&&!a.shiftKey&&(d.scrollTop+=a.detail*2,r(),a.preventDefault())},!1),e.addEventListener("click",function(a){if(a.srcElement===f||a.button>0)return;var b=a.pageY,c=f.getBoundingClientRect(),h=e.getBoundingClientRect(),i;b>c.bottom?f.style.top=b-h.top-k+"px":b<c.top&&(f.style.top=b-h.top+"px"),i=f.offsetTop/(g-k),d.scrollTop=(j-g)*i},!1),window.addEventListener("resize",n,!1),f.addEventListener("mousedown",q,!1),n(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return e}}})}function d(b,c){function m(){g=b.getBoundingClientRect().width,h=c.getBoundingClientRect().width,f=d.getBoundingClientRect().width,i=c.scrollWidth,j=f-(i-g),j=Math.max(20,Math.min(f,j)),e.style.width=j+"px",q()}function n(){window.removeEventListener("mouseup",n,!1),window.removeEventListener("mousemove",o,!1),e.addEventListener("mousedown",p,!1)}function o(a){var b=a.pageX-k;b=Math.max(0,Math.min(b,f-j)),e.style.left=b+"px";var d=e.offsetLeft/(f-j);c.scrollLeft=(i-f)*d,l.dispatch("scroll",c.scrollLeft)}function p(a){if(a.button===0){var b=e.offsetLeft;k=a.pageX-b,window.addEventListener("mouseup",n,!1),window.addEventListener("mousemove",o,!1),e.removeEventListener("mousedown",p,!1)}}function q(){i-f>0?e.style.left=(f-j)*(c.scrollLeft/(i-f))+"px":e.style.left="0px"}var d=document.createElement("div"),e=document.createElement("div"),f,g,h,i,j,k=0,l=this;a(l),d.className="scroll-bar scroll-bar-h",e.className="scroll-handle",d.appendChild(e),c.addEventListener("scroll",function(a){q()},!1),c.addEventListener("mousewheel",function(a){a.wheelDeltaX&&(c.scrollLeft-=a.wheelDeltaX,q(),a.preventDefault())},!1),c.addEventListener("DOMMouseScroll",function(a){if(a.axis===a.HORIZONTAL_AXIS||a.axis===a.VERTICAL_AXIS&&a.shiftKey)c.scrollLeft+=a.detail*2,q(),a.preventDefault()},!1),d.addEventListener("click",function(a){if(a.srcElement===e||a.button>0)return;var b=a.pageX,g=e.getBoundingClientRect(),h=d.getBoundingClientRect(),k;b>g.right?e.style.left=b-h.left-j+"px":b<g.left&&(e.style.left=b-h.left+"px"),k=e.offsetLeft/(f-j),c.scrollLeft=(i-f)*k},!1),window.addEventListener("resize",m,!1),e.addEventListener("mousedown",p,!1),this.update=function(){m()},m(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return d}}})}var b=3;return{Vertical:c,Horizontal:d}}),c("plugin/plugin-list",["util/dragndrop"],function(a){return function(b){var c=document.createElement("div"),d=document.createElement("div");c.id="plugin-list",d.className="container",c.appendChild(d),b.ui.areas.work.addComponent(c,{states:["add-popcorn"],transitionIn:function(){c.style.display="block",setTimeout(function(){c.style.opacity="1"},0)},transitionOut:function(){c.style.opacity="0"},transitionInComplete:function(){},transitionOutComplete:function(){c.style.display="none"}}),b.listen("pluginadded",function(c){var e=document.createElement("div"),f=c.data.helper,g=document.createElement("span"),h=document.createElement("span");a.helper(e,{start:function(){var a=b.targets,c=b.currentMedia;c.view.blink();for(var d=0,e=a.length;d<e;++d)a[d].view.blink()},stop:function(){}}),f&&(g.style.backgroundImage="url('"+f.src+"')",g.className="icon",e.appendChild(g)),h.className="label",h.innerHTML=c.data.type,e.appendChild(h),e.setAttribute("data-popcorn-plugin-type",c.data.type),e.setAttribute("data-butter-draggable-type","plugin"),d.appendChild(e)}),c.style.display="none",c.classList.add("fadable")}}),c("dependencies",[],function(){var a=/\{([\w\-\._]+)\}/,b=10,c=function(){var a=0;return function(){return a++>0}};return function(d){function f(b){var c,d;while(a.test(b))c=a.exec(b),d=e[c[1]]||"",b=b.replace(c[0],d);return b.replace("//","/")}function h(a,b){var c=0;return function(){++c,c===a.length&&b&&b()}}function i(a,b){function d(){c===a.length?b():j.load(a[c++],d)}var c=0;return d}var e=d.value("dirs"),g={js:function(a,b,d,e){e=e||c(),a=f(a);if(!e()){var g=document.createElement("script");g.src=a,g.type="text/javascript",document.head.appendChild(g),g.onload=g.onreadystatechange=d}else d&&d()},css:function(a,c,d,e,g){function j(){i=setInterval(function(){e()&&(clearInterval(i),d&&d())},b)}var h,i;e=e||function(){return!!h},a=f(a),e()?d&&d():(h=document.createElement("link"),h.rel="stylesheet",h.onload=j,h.onerror=g,h.href=a,document.head.appendChild(h))}},j={load:function(a,b,c,d){if(a instanceof Array&&a.length>0){var e=h(a,b);if(!d)for(var f=0;f<a.length;++f)j.load(a[f],e);else{var k=i(a,b);k()}}else{var l=a;if(!g[l.type])throw new Error("Loader type "+l.type+" not found! Attempted: "+l.url);if(!l.url)throw new Error("Attempted to load resource without url.");g[l.type](l.url,l.exclude,b,l.check,c)}}};return j}}),c("dialog/modal",[],function(){var a=document.createElement("div"),b=function(b){a.parentNode||(a.className="butter-modal-container",a.setAttribute("data-butter-exclude",!0),document.body.appendChild(a));var c=document.createElement("div");c.classList.add("layer"),a.appendChild(c),setTimeout(function(){c&&c.classList.add("fade-in")},10),c.appendChild(b),this.destroy=function(){a.removeChild(c),c=null},Object.defineProperties(this,{element:{enumerable:!0,get:function(){return c}}})};return b.element=a,b}),c("util/keys",[],function(){return{DELETE:8,TAB:9,ESCAPE:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,EQUALS:187,MINUS:189}}),c("ui/context-button",[],function(){return function(a){var b=document.createElement("butter-button");b.id="add-popcorn",b.title="Add Popcorn Events to the timeline",b.classList.add("butter-btn"),b.innerHTML='<span class="icon icon-plus-sign"></span> Popcorn',b.addEventListener("click",function(){a.ui.contentState==="timeline"?(a.ui.setContentState("add-popcorn"),a.ui.contentStateLocked=!0):(a.ui.contentStateLocked=!1,a.ui.setContentState("timeline"))},!1),a.ui.areas.tools.addComponent(b,{states:["add-popcorn","editor"],transitionIn:function(){b.setAttribute("disabled",!0),b.innerHTML="Done",b.title="Finish adding Popcorn Events",b.classList.add("add-popcorn-done")},transitionInComplete:function(){b.removeAttribute("disabled")},transitionOut:function(){b.setAttribute("disabled",!0),b.innerHTML='<span class="icon icon-plus-sign"></span> Popcorn',b.title="Add Popcorn Events to the timeline",b.classList.remove("add-popcorn-done")},transitionOutComplete:function(){b.removeAttribute("disabled")}})}}),c("ui/unload-dialog",[],function(){return function(a){var b=!1,c=["mediacontentchanged","mediatargetchanged","trackadded","trackremoved","tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated"],d=function(){return"You have unsaved project data."},e=function(){b||(b=!0,window.onbeforeunload=d)};a.listen("ready",function(){for(var b=0,d=c.length;b<d;b++)a.listen(c[b],e)}),a.listen("projectsaved",function(){b=!1,window.onbeforeunload=null})}}),function(){function a(a){var b=[];if(!a)return null;for(var c in a)a.hasOwnProperty(c)&&(b[b.length]=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&").replace("/%20/g","+")}c("util/xhr",[],function(){function b(){var a=document.getElementById("csrf_token_id");a&&(c=a.value)}var c;document.readyState!=="loading"?b():document.addEventListener("DOMContentLoaded",b,!1);var d={get:function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.onreadystatechange=b,d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.overrideMimeType&&c&&d.overrideMimeType(c),d.send(null)},post:function(b,d,e,f){var g=new XMLHttpRequest;g.open("POST",b,!0),g.onreadystatechange=e,g.setRequestHeader("X-Requested-With","XMLHttpRequest"),c&&g.setRequestHeader("X-CSRFToken",c),f?(g.setRequestHeader("Content-Type",f),g.send(d)):(g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(a(d)))}};return d})}(),c("cornfield/module",["util/xhr"],function(a){function b(){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}var c=function(c,d){var e=!1,f="",g="",h="",i=b();if(!navigator.id){var j=document.createElement("script");j.src="https://browserid.org/include.js",j.type="text/javascript",j.setAttribute("data-butter-exclude",!0),document.head.appendChild(j)}this.login=function(b){navigator.id.get(function(d){d?a.post(i+"/browserid/verify",{audience:i,assertion:d},function(){if(this.readyState===4)try{var a=JSON.parse(this.response);if(a.status==="okay"){c.cornfield.whoami(function(a){b(a)});return}b(a)}catch(d){b({error:"an unknown error occured"})}}):b(undefined)})},this.whoami=function(b){a.get(i+"/api/whoami",function(){if(this.readyState===4){var a;try{a=JSON.parse(this.response),this.status===200&&(e=!0,f=a.email,h=a.username,g=a.name)}catch(c){a={error:"failed to parse data from server: \n"+this.response}}b&&b(a)}})},c.listen("ready",function k(){c.unlisten("ready",k),c.cornfield.whoami(function(a){a.error||c.dispatch("autologinsucceeded",a)})}),this.email=function(){return f},this.name=function(){return g},this.username=function(){return h},this.authenticated=function(){return e},this.publish=function(b,c){a.post(i+"/api/publish/"+b,null,function(){if(this.readyState===4){var a;try{a=JSON.parse(this.response)}catch(b){c({error:"an unknown error occured"});return}c(a)}})},this.logout=function(b){a.get(i+"/browserid/logout",function(){f="";if(this.readyState===4){var a;try{a=JSON.parse(this.response),e=!1,f="",h="",g=""}catch(c){a={error:"an unknown error occured"}}b&&b(a)}})},this.list=function(b){a.get(i+"/api/projects",function(){if(this.readyState===4){var a;try{a=JSON.parse(this.response)}catch(c){b({error:"an unknown error occured"});return}b(a)}})},this.load=function(b,c){a.get(i+"/api/project/"+b,function(){if(this.readyState===4)try{var a=JSON.parse(this.response);c(a)}catch(b){c({error:"an unknown error occured"})}})},this.save=function(b,c,d){var e=i+"/api/project/";b&&(e+=b),a.post(e,c,function(){if(this.readyState===4)try{var a=JSON.parse(this.response);d(a)}catch(b){d({error:"an unknown error occured"})}},"application/json")}};return c.__moduleName="cornfield",c}),c("util/lang",[],function(){return{extend:function(a){var b=a,c=[].slice.call(arguments,1);c.forEach(function(a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])})},smpteToSeconds:function(a){var b=a.split(":");if(b.length===1)return parseFloat(b[0],10);if(b.length===2)return parseFloat(b[0],10)+parseFloat(b[1]/12,10);if(b.length===3)return parseInt(b[0]*60,10)+parseFloat(b[1],10)+parseFloat(b[2]/12,10);if(b.length===4)return parseInt(b[0]*3600,10)+parseInt(b[1]*60,10)+parseFloat(b[2],10)+parseFloat(b[3]/12,10)},secondsToSMPTE:function(a){var b=new Date(1970,0,1),c;return b.setSeconds(a),c=b.toTimeString().substr(0,8),c>86399&&(c=Math.floor((b-Date.parse("1/1/70"))/36e5)+c.substr(2)),c},clone:function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},defaults:function(a,b){for(var c in b)a[c]===undefined&&(a[c]=b[c]);return a},domFragment:function(a){var b=document.createRange(),c;b.selectNode(document.body.firstChild),c=b.createContextualFragment(a);if(c.childNodes.length===1){var d=c.firstChild;return c.removeChild(d),d}return c}}}),c("core/trackevent",["./logger","./eventmanager","util/lang","util/time","./views/trackevent-view"],function(a,b,c,d,e){var f=0,g=function(a,b){this.type="trackevent-update",this.reason=a,this.message=b,this.toString=function(){return"TrackEvent update failed: "+b}},h=function(h){function s(a){return a.default?a.default:a.type==="number"?0:""}h=h||{};var i=this,j="TrackEvent"+f++,k=h.name||j,l=new a(j),m,n=h.type+"",o=h.popcornOptions||{start:0,end:1},p=new e(this,n,o),q=null,r=!1;b(i),i.popcornOptions=o,i.popcornTrackEvent=null,n?this.manifest=Popcorn.manifest[n]:l.log("Warning: "+j+" has no type."),o.start=o.start||0,o.start=d.roundTime(o.start),o.end=o.end||o.start+1,o.end=d.roundTime(o.end),this.setPopcornWrapper=function(a){q=a},this.update=function(a,b){a=a||{};var c=o.start,e=o.end,f;if(a.start){if(!!isNaN(a.start))throw new g("invalid-start-time","[start] is an invalid value.");c=d.roundTime(a.start)}if(a.end){if(!!isNaN(a.end))throw new g("invalid-end-time","[end] is an invalid value.");e=d.roundTime(a.end)}if(c>=e)throw new g("start-greater-than-end","[start] must be equal to or less than [end].");if(m&&m._media&&m._media.ready){var h=m._media;if(c>h.duration||e>h.duration||c<0)throw new g("invalid-times","[start] or [end] are not within the duration of media")}if(this.manifest){f=this.manifest.options;if(f){for(var j in f)f.hasOwnProperty(j)&&(a[j]===undefined?b&&(o[j]=s(f[j])):o[j]=a[j]);!("target"in f)&&a.target&&(o.target=a.target)}}c&&(o.start=c),e&&(o.end=e),q&&q.updateEvent(i),p.update(o),i.popcornOptions=o,i.dispatch("trackeventupdated",i)},this.moveFrameLeft=function(a,b){b?o.end-o.start>a?o.end-=a:o.end=o.start:o.start>a?(o.start-=a,o.end-=a):(o.end=o.end-o.start,o.start=0),i.dispatch("trackeventupdated",i),p.update(o)},this.moveFrameRight=function(a,b){o.end<m._media.duration-a?(o.end+=a,b||(o.start+=a)):(b||(o.start+=m._media.duration-o.end),o.end=m._media.duration),i.dispatch("trackeventupdated",i),p.update(o)},Object.defineProperties(this,{_track:{enumerable:!0,get:function(){return m},set:function(a){m=a,m&&i.update(o)}},view:{enumerable:!0,configurable:!1,get:function(){return p}},dragging:{enumerable:!0,configurable:!1,get:function(){return p.dragging}},type:{enumerable:!0,get:function(){return n}},name:{enumerable:!0,get:function(){return k}},id:{enumerable:!0,get:function(){return j}},selected:{enumerable:!0,get:function(){return r},set:function(a){a!==r&&(r=a,p.selected=r,r?i.dispatch("trackeventselected"):i.dispatch("trackeventdeselected"))}},json:{enumerable:!0,get:function(){return{id:j,type:n,popcornOptions:c.clone(o),track:m?m.name:undefined,name:k}},set:function(a){n=o.type=a.type,this.manifest=Popcorn.manifest[n],a.name&&(k=a.name),o=a.popcornOptions,i.popcornOptions=o,p.type=n,p.update(o),i.dispatch("trackeventupdated",i)}}})};return h}),c("core/track",["./logger","./eventmanager","./trackevent","./views/track-view"],function(a,b,c,d){var e=0,f=function(f){f=f||{};var g=[],h="Track"+e++,i=f.target,j=new a(h),k=f.name||h,l=f.order||0,m=new d(this),n=null,o=this;o._media=null,b(o),this.setPopcornWrapper=function(a){n=a;for(var b=0,c=g.length;b<c;++b)g[b].setPopcornWrapper(a)},Object.defineProperties(this,{view:{enumerable:!0,configurable:!1,get:function(){return m}},order:{enumerable:!0,get:function(){return l},set:function(a){l=a,o.dispatch("trackorderchanged",l)}},target:{enumerable:!0,get:function(){return i},set:function(a){i=a,o.dispatch("tracktargetchanged",o);for(var b=0,c=g.length;b<c;b++)g[b].target=a,g[b].update({target:a});j.log("target changed: "+a)}},name:{enumerable:!0,get:function(){return k},set:function(a){k=a,o.dispatch("tracknamechanged",o)}},id:{enumerable:!0,configurable:!1,get:function(){return h}},json:{enumerable:!0,get:function(){var a=[];for(var b=0,c=g.length;b<c;++b)a.push(g[b].json);return{name:k,id:h,trackEvents:a}},set:function(a){a.name&&(k=a.name);if(a.trackEvents){var b=a.trackEvents;for(var d=0,e=b.length;d<e;++d){var f=new c;f.json=b[d],o.addTrackEvent(f)}}}},trackEvents:{enumerable:!0,configurable:!1,get:function(){return g}}}),this.getTrackEventById=function(a){for(var b=0,c=g.length;b<c;++b)if(g[b].id===a)return g[b]},this.getTrackEventByName=function(a){for(var b=0,c=g.length;b<c;++b)if(g[b].name===a)return g[b]},this.addTrackEvent=function(a){return a instanceof c||(a=new c(a),a.update(a.popcornOptions,!0)),i&&(a.target=i),a._track=o,g.push(a),a.track=o,o.chain(a,["trackeventupdated","trackeventselected","trackeventdeselected"]),m.addTrackEvent(a),a.track=o,a.setPopcornWrapper(n),o.dispatch("trackeventadded",a),a},this.removeTrackEvent=function(a){var b=g.indexOf(a);if(b>-1)return g.splice(b,1),o.unchain(a,["trackeventupdated","trackeventselected","trackeventdeselected"]),m.removeTrackEvent(a),a._track=null,a.setPopcornWrapper(null),o.dispatch("trackeventremoved",a),a},this.deselectEvents=function(a){for(var b=0,c=g.length;b<c;++b)g[b]!==a&&(g[b].selected=!1)}};return f}),c("timeline/timebar",["util/lang","./scrubber"],function(a,b){var c=5;return function(d,e,f,g){function n(b){var d=f.container.getBoundingClientRect().width,e=Math.min(d,l.container.scrollWidth),g=Math.min(e,l.element.offsetWidth-c);j.style.width=g+"px";var h=i.getContext("2d");i.height!==i.offsetHeight&&(i.height=i.offsetHeight),i.width!==g&&(i.width=g);var n=l.element.firstChild.clientWidth/k.duration,o=h.measureText(a.secondsToSMPTE(5)).width,p=20,q=0,r=-((o+p)/2),s=l.element.scrollLeft/n,t=(l.element.scrollLeft+g)/n;h.clearRect(0,0,i.width,i.height),h.translate(-l.element.scrollLeft,0),h.beginPath();for(var u=1,v=k.duration+1;u<v;u++){if(u+1<s)continue;if(u-1>t)break;var w=u*n,x=-~w+~q;x>3&&(x>6&&(h.moveTo(-~w-x/2,0),h.lineTo(-~w-x/2,7),x>12&&(h.moveTo(-~w-x/4*3,0),h.lineTo(-~w-x/4*3,4),h.moveTo(-~w-x/4,0),h.lineTo(-~w-x/4,4))),h.moveTo(-~w,0),h.lineTo(-~w,10),w-r>o+p&&(r=w,h.fillStyle="#999999",h.fillText(a.secondsToSMPTE(u),-~w-o/2,21)),q=w)}h.strokeStyle="#999999",h.stroke(),h.translate(l.element.scrollLeft,0),m.update(g,b)}var h=document.createElement("div"),i=document.createElement("canvas"),j=document.createElement("div"),k=e,l=f,m=new b(d,h,k,l,g);h.className="time-bar",j.className="time-bar-canvas-container",j.appendChild(i),h.appendChild(j),i.addEventListener("mousedown",m.onMouseDown,!1),l.element.addEventListener("scroll",n,!1),window.addEventListener("resize",n,!1),this.update=function(a){n(a)},this.destroy=function(){m.destroy()},Object.defineProperties(this,{element:{enumerable:!0,get:function(){return h}}})}}),c("plugin/plugin",["util/dragndrop","util/lang"],function(a,b){var c="popcorn-plugin-";return function(d,e){e=e||{};var f="plugin"+d,g=this,h=e.type,i=e.path,j={},k=e.type,l=document.getElementById(g.type+"-icon")||document.getElementById("default-icon");if(i&&!Popcorn.manifest[k]){var m=document.getElementsByTagName("HEAD")[0],n=document.createElement("script");n.src=i,m.appendChild(n)}Object.defineProperties(this,{id:{enumerable:!0,get:function(){return f}},name:{enumerable:!0,get:function(){return h}},path:{enumerable:!0,get:function(){return i}},manifest:{enumerable:!0,get:function(){return j},set:function(a){j=a}},type:{enumerable:!0,get:function(){return k}},helper:{enumerable:!0,get:function(){return l}}}),l=document.getElementById(g.type+"-icon")||document.getElementById("default-icon"),l&&(l=l.cloneNode(!1)),this.createElement=function(d,e){var f;if(!e)f=document.createElement("span"),f.innerHTML=g.type+" ";else{var h=e.replace(/\$type/g,g.type);f=b.domFragment(h)}return f.id=c+g.type,f.setAttribute("data-popcorn-plugin-type",g.type),f.setAttribute("data-butter-draggable-type","plugin"),a.helper(f,{image:l,start:function(){var a=d.targets,b=d.currentMedia;b.view.blink();for(var c=0,e=a.length;c<e;++c)a[c].view.blink()},stop:function(){}}),this.element=f,f}}}),function(){c("plugin/module",["core/logger","util/dragndrop","util/scrollbars","./plugin-list","./plugin"],function(a,b,c,d,e){function j(a){var b=0,c=0,d=0,e=a;while(e.length<9)e+=a;b=(e.charCodeAt(0)+e.charCodeAt(3)+e.charCodeAt(6))%(e.charCodeAt(8)*5%360),c=(e.charCodeAt(0)+e.charCodeAt(2)+e.charCodeAt(4)+e.charCodeAt(6))%100*.05+95,d=(e.charCodeAt(1)+e.charCodeAt(3)+e.charCodeAt(5)+e.charCodeAt(7))%100*.2+40;if(b<20||b>340)d+=10;return b>160&&b<200&&(d-=10),{h:b,s:c,l:d}}function k(a){var b="",c=j(a);b+=h+"["+g+'="'+a+'"]{',b+="background: hsl( "+c.h+", "+c.s+"%, "+c.l+"% );",b+="}",i.innerHTML=i.innerHTML+b}var f={},g="data-butter-trackevent-type",h="#butter-timeline .butter-track-event",i=document.createElement("style");i.type="text/css",i.media="screen",i.setAttribute("data-butter-exclude","true");var l=function(a,g){var h=[],j=document.createElement("div"),l=document.createElement("div"),m=document.createElement("div"),n=this,o='<div class="list-item $type_tool">$type</div>';j.id="popcorn-plugin",m.className="list",l.className="list-wrapper";var p=document.createElement("div");p.className="title",p.innerHTML="<span>My Events</span>",j.appendChild(p),l.appendChild(m),j.appendChild(l);var q=new c.Vertical(l,m);j.appendChild(q.element),this._start=function(b){a.ui&&(document.head.appendChild(i),a.ui.areas.tools.addComponent(j),d(a)),g&&g.plugins?n.add(g.plugins,b):b()},this.add=function(b,c){if(b instanceof Array){var d=0,i=0,j=0,l=function(){++d===b.length&&c&&c()};for(i=0,j=b.length;i<j;i++)n.add(b[i],l)}else{f[b.type]||k(b.type),b=new e(h.length,b);var p=setInterval(function(a){if(!Popcorn.manifest[b.type])return;b.manifest=Popcorn.manifest[b.type],clearInterval(p),c&&c()},100);h.push(b),g.defaults&&g.defaults.indexOf(b.type)>-1&&m.appendChild(b.createElement(a,o)),a.dispatch("pluginadded",b)}return q.update(),b},this.remove=function(b){if(typeof b=="string"){b=this.get(b);if(!b)return}var c,d;for(c=0,d=h.length;c<d;c++)if(h[c].name===b.name){var e=a.tracks;for(c=0,d=e.length;c<d;c++){var f=e[c].trackEvents;for(var g=0,i=f.length-1;i>=g;i--)f[i].type===b.name&&e[c].removeTrackEvent(f[i])}h.splice(c,1),d--,m.removeChild(b.element);var j=document.getElementsByTagName("HEAD")[0];for(c=0,d=j.children.length;c<d;c++)j.children[c].getAttribute("src")===b.path&&j.removeChild(j.children[c]);a.dispatch("pluginremoved",b)}q.update()},this.clear=function(){while(h.length>0){var b=h.pop();m.removeChild(b.element),a.dispatch("pluginremoved",b)}},this.get=function(a){for(var b=0,c=h.length;b<c;++b)if(h[b].name===a)return h[b]},b.droppable(j,{drop:function(b){if(b.getAttribute("data-butter-draggable-type")==="plugin"){var c=b.getAttribute("data-popcorn-plugin-type"),d=n.get(c);if(d){for(var e=0;e<m.childNodes.length;++e)if(m.childNodes[e].getAttribute("data-popcorn-plugin-type")===c)return;m.appendChild(d.createElement(a,o))}}}})};return l.__moduleName="plugin",l})}(),c("dialog/dialog",["util/lang","core/eventmanager","./modal"],function(a,b,c){function g(d,e){return function(g){function n(a){!k||f.indexOf(a.target.nodeName)!==-1||a.which!==13&&a.keyCode!==13?l&&f.indexOf(a.target.nodeName)===-1&&(a.which===27||a.keyCode===27)&&i[l](a):i[k](a)}g=g||{};var h=g.events||{},i={},j=a.domFragment(d),k,l,m;if(!j.classList||!j.classList.contains("butter-dialog"))j=j.querySelector(".butter-dialog");var o={rootElement:j,activity:function(a){i[a]()},enableCloseButton:function(){var a=j.querySelector(".close-button");a&&a.addEventListener("click",function b(c){o.activity("default-close"),a.removeEventListener("click",b,!1)},!1)},showError:function(a){var b=j.querySelector(".error");b&&(b.innerHTML=a,j.setAttribute("data-error",!0))},hideError:function(){j.removeAttribute("data-error")},assignEnterKey:function(a){k=a},assignEscapeKey:function(a){l=a},registerActivity:function(a,b){i[a]=b},assignButton:function(a,b){var c=j.querySelector(a);c.addEventListener("click",i[b],!1)},enableElements:function(){var a=arguments.length;while(a--)j.querySelector(arguments[a]).removeAttribute("disabled")},disableElements:function(){var a=arguments.length;while(a--)j.querySelector(arguments[a]).setAttribute("disabled",!0)},send:function(a,b){p.dispatch(a,b)}},p={element:j,open:function(){for(var a in h)h.hasOwnProperty(a)&&p.listen(a,h[a]);m=new c(j),setTimeout(function(){p.focus()},0),document.addEventListener("keydown",n,!1),o.dispatch("open"),p.dispatch("open")},close:function(){for(var a in h)h.hasOwnProperty(a)&&a!=="close"&&o.unlisten(a,h[a]);m.destroy(),m=null,document.removeEventListener("keydown",n,!1),o.dispatch("close"),p.dispatch("close")},send:function(a,b){o.dispatch(a,b)},focus:function(){j.focus(),o.dispatch("focus")}};return b(o),b(p),o.registerActivity("default-close",function(){p.close()}),o.registerActivity("default-ok",function(){p.dispatch("submit"),p.close()}),e(o,g.data),p}}var d={},e={},f=["TEXTAREA"];return{register:function(a,b,c){d[a]=g(b,c)},spawn:function(a,b){if(d[a])return e[a]?e[a].focus():(e[a]=d[a](b),e[a].listen("close",function(){e[a]=null})),e[a];throw"Dialog '"+a+"' does not exist."},modal:c}}),c("timeline/trackhandles",["dialog/dialog","util/dragndrop"],function(a,b){var c=37;return function(d,e,f,g){function p(b){var d=b.data,f=d.id,g=d.name,h=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div");i.className="menu",n.className="delete",i.appendChild(n),n.addEventListener("click",function(b){var c=a.spawn("delete-track",{data:g,events:{submit:function(a){a.data===!0&&e.removeTrack(d),c.close()},cancel:function(a){c.close()}}});c.open()},!1),h.addEventListener("dblclick",function(b){var c=a.spawn("track-data",{data:d,events:{submit:function(a){try{var b=JSON.parse(a.data),e=d.trackEvents,f=b.trackEvents,g={},i=[],j,k;h.childNodes[0].textContent=d.name=b.name;for(j=0,k=f.length;j<k;j++){var l=f[j],m=d.getTrackEventById(l.id);m?(m.update(l.popcornOptions),g[l.id]=l):i.push({type:l.type,popcornOptions:l.popcornOptions})}for(j=e.length,k=0;j>=k;j--)e[j]&&!g[e[j].id]&&d.removeTrackEvent(e[j]);for(j=0,k=i.length;j<k;j++)d.addTrackEvent(i[j]);c.send("track-updated")}catch(n){c.send("error")}}}});c.open()},!1),m.push(i),h.className="track-handle",h.id="track-handle-"+f,h.setAttribute("data-butter-track-id",f),h.appendChild(document.createTextNode(g)),h.appendChild(i),o.addItem(h),j.appendChild(h),l[f]={id:f,track:d,element:h,menu:i},k.style.top=j.offsetHeight-c+"px"}var h=e,i=document.createElement("div"),j=document.createElement("div"),k=document.createElement("button"),l={},m=[],n=this;i.className="track-handle-container",j.className="handle-list",i.appendChild(j),k.id="add-track",k.innerHTML='<span class="icon icon-plus-sign"></span> Track',k.classList.add("butter-btn"),k.title="Add a new Track for your events",i.appendChild(k),k.addEventListener("click",function(a){d.currentMedia.addTrack()},!1);var o=b.sortable(j,{change:function(a){var b=[];for(var c=0,d=a.length;c<d;++c){var e=a[c].getAttribute("data-butter-track-id");b.push(l[e].track)}g(b)}}),q=h.tracks;for(var r=0;r<q.length;++r)p({data:q[r]});h.listen("trackadded",p),h.listen("trackremoved",function(a){var b=a.data.id;j.removeChild(l[b].element),o.removeItem(l[b].element),m.splice(m.indexOf(l[b].menu),1),delete l[b],k.style.top=j.offsetHeight-c+"px"}),f.element.addEventListener("scroll",function(a){i.scrollTop=f.element.scrollTop},!1),this.update=function(){i.scrollTop=f.element.scrollTop,k.style.top=j.offsetHeight-c+"px"},n.update(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return i}}})}}),c("timeline/media",["core/trackevent","core/track","core/eventmanager","./track-container","./scrollbars","./timebar","./zoombar","./status","./trackhandles"],function(a,b,c,d,e,f,g,h,i){function l(a,b){function l(a){p.orderTracks(a)}function m(a){var b=j*a+C;b!==D&&(D=b,p.zoom=D,P())}function E(){p.snapTo(o.currentTime),t.update()}function F(b){b!==o.target?(b=a.getTargetByType("elementID",b),b&&b.view.blink()):o.view.blink()}function G(a){var b=a.trackEvent,c=b.popcornOptions;c.target&&F(c.target)}function H(a){}function I(a){if(B&&A==="click"){var b=B.popcornOptions;b.target&&F(b.target)}}function J(a){B=null}function K(b){var c=b.data.trackEvent,d=b.data.originalEvent;B=c,c.selected=!0;if(!d.shiftKey){var e=o.tracks;for(var f in e)e.hasOwnProperty(f)&&e[f].deselectEvents(c);a.selectedEvents=[c]}else a.selectedEvents.push(c)}function L(){C=r.clientWidth/o.duration,D=k,x.zoom(D),p.zoom=D,P(),n.dispatch("ready")}function M(){function b(a){var b=a.data;b.view.listen("trackeventdragstarted",J),b.view.listen("trackeventmouseup",I),b.view.listen("trackeventmousedown",K),A==="hover"&&(b.view.listen("trackeventmouseover",G),b.view.listen("trackeventmouseout",H))}function c(a){var c=a.data;c.view.listen("plugindropped",N),c.view.listen("trackeventdropped",O),c.view.listen("trackeventmousedown",K),A==="hover"&&(c.view.listen("trackeventmouseover",G),c.view.listen("trackeventmouseout",H));var d=c.trackEvents;for(var e=0;e<d.length;++e)b({data:d[e]})}o.unlisten("mediaready",M),o.listen("mediaready",L),r.appendChild(p.element),r.appendChild(t.element),r.appendChild(u.element),s.appendChild(w.element),s.appendChild(y.statusElement),s.appendChild(y.muteElement),a.ui.areas.statusbar.element.appendChild(s),q.appendChild(z.element),q.appendChild(x.element),q.appendChild(r),o.listen("trackeventremoved",function(a){var b=a.data;b.view.unlisten("trackeventdragstarted",J),b.view.unlisten("trackeventmouseup",I),b.view.unlisten("trackeventmousedown",K),A==="hover"&&(b.view.unlisten("trackeventmouseover",G),b.view.unlisten("trackeventmouseout",H))});var d=o.tracks;for(var e=0;e<d.length;++e)c({data:d[e]});o.listen("trackadded",c),o.listen("trackeventadded",b),o.listen("trackremoved",function(a){var b=a.data;b.view.unlisten("plugindropped",N),b.view.unlisten("trackeventdropped",O),b.view.listen("trackeventmousedown",K),A==="hover"&&(b.view.listen("trackeventmouseover",G),b.view.listen("trackeventmouseout",H))}),L()}function N(b){var c=b.data.type,d=b.data.track,e=b.data.start;e+1>o.duration&&(e=o.duration-1);var f=a.defaultTarget;!f&&a.targets.length>0&&(f=a.targets[0]),d.addTrackEvent({popcornOptions:{start:e,end:e+1,target:f.elementID},type:c}),f&&f.view.blink()}function O(a){var b=o.findTrackWithTrackEventId(a.data.trackEvent),c=b.trackEvent,d=c.popcornOptions;b.track.removeTrackEvent(c);var e=d.end-d.start;d.start=a.data.start,d.end=d.start+e,c.update(d),a.data.track.addTrackEvent(c)}function P(){o.duration&&(p.update(),w.update(D),t.update(),u.update(),x.update(),z.update())}var n=this,o=b,p=new d(a,b),q=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),t=new e.Horizontal(p),u=new e.Vertical(p,q),v=!1,w=new f(a,o,p,t),x=new g(m),y=new h(o),z=new i(a,o,p,l),A=a.config.value("ui").trackEventHighlight||"click",B,C,D;p.setScrollbars(t,u),c(n),q.className="media-instance",q.id="media-instance"+b.id,r.className="media-container",s.className="media-status-container",o.listen("mediaplaying",E),o.listen("mediapause",E),o.listen("mediaready",M),this.destroy=function(){q.parentNode.removeChild(q),s.parentNode&&a.ui.areas.statusbar.element.removeChild(s),w.destroy()},this.hide=function(){q.style.display="none"},this.show=function(){q.style.display="block"},a.listen("ready",function(){P()}),p.zoom=D,Object.defineProperties(this,{zoom:{enumerable:!0,get:function(){return D},set:function(a){D=a,P()}},element:{enumerable:!0,configurable:!1,get:function(){return q}},media:{enumerable:!0,configurable:!1,get:function(){return o}},shrunken:{enumerable:!0,configurable:!1,get:function(){return v},set:function(a){a!==v&&(v=a)}}})}var j=300,k=.5;return l}),c("timeline/module",["core/logger","./media"],function(a,b){var c=function(a,c){var d={},e,f=document.createElement("div");f.id="butter-timeline",f.classList.add("fadable"),this._start=function(b){a.ui.areas.work.addComponent(f,{states:["timeline"],transitionIn:function(){f.style.visibility="visible",setTimeout(function(){f.style.opacity="1"},0)},transitionInComplete:function(){},transitionOut:function(){f.style.opacity="0"},transitionOutComplete:function(){f.style.visibility="hidden"}}),a.ui.registerStateToggleFunctions("timeline",{transitionIn:function(){f.removeAttribute("data-butter-disabled")},transitionOut:function(){f.setAttribute("data-butter-disabled",!0)}}),a.ui.pushContentState("timeline"),b()},a.ui&&a.ui.listen("uivisibilitychanged",function(a){for(var b in d)d.hasOwnProperty(b)&&(d[b].shrunken=!a.data)}),this.findAbsolutePosition=function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return[b,c]},a.listen("mediaadded",function(c){function i(b){e!==d[b.data.id]&&(e&&e.hide(),e=d[b.data.id],e&&e.show(),a.dispatch("timelineready"))}function j(b){var c=b.data;d[c.id]&&d[c.id].destroy(),delete d[c.id],e&&c.id===e.media.id&&(e=undefined),a.unlisten("mediachanged",i),a.unlisten("mediaremoved",j)}var g=c.data,h=new b(a,g);d[g.id]=h,f.appendChild(h.element),a.listen("mediachanged",i),a.listen("mediaremoved",j)}),Object.defineProperties(this,{zoom:{get:function(){return e.zoom},set:function(a){e.zoom=a}}})};return c.__moduleName="timeline",c}),function(){var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],d=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,e=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,g=f&&location.protocol&&location.protocol.replace(/\:/,""),h=f&&location.hostname,i=f&&(location.port||void 0),j=[];c("text",[],function(){var c,l;return c={version:"1.0.8",strip:function(a){if(a){var a=a.replace(d,""),b=a.match(e);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var b,c,d;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(c=0;c<3;c++){d=a[c];try{b=new ActiveXObject(d)}catch(e){}if(b){a=[d];break}}return b},parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),a=a.substring(c+1,a.length),c=a.indexOf("!");return c!==-1&&(b=a.substring(c+1,a.length),b=b==="strip",a=a.substring(0,c)),{moduleName:d,ext:a,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,d,e){var f=c.xdRegExp.exec(a),g;return f?(a=f[2],f=f[3],f=f.split(":"),g=f[1],f=f[0],(!a||a===b)&&(!f||f===d)&&(!g&&!f||g===e)):!0},finishLoad:function(a,b,d,e,f){d=b?c.strip(d):d,f.isBuild&&(j[a]=d),e(d)},load:function(a,b,d,e){if(e.isBuild&&!e.inlineText)d();else{var j=c.parseName(a),k=j.moduleName+"."+j.ext,l=b.toUrl(k),m=e&&e.text&&e.text.useXhr||c.useXhr;!f||m(l,g,h,i)?c.get(l,function(b){c.finishLoad(a,j.strip,b,d,e)}):b([k],function(a){c.finishLoad(j.moduleName+"."+j.ext,j.strip,a,d,e)})}},write:function(a,b,d){if(j.hasOwnProperty(b)){var e=c.jsEscape(j[b]);d.asModule(a+"!"+b,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,b,d,e,f){var b=c.parseName(b),g=b.moduleName+"."+b.ext,h=d.toUrl(b.moduleName+"."+b.ext)+".js";c.load(g,d,function(){var b=function(a){return e(h,a)};b.asModule=function(a,b){return e.asModule(a,h,b)},c.write(a,g,b,f)},f)}},c.createXhr()?c.get=function(a,b){var d=c.createXhr();d.open("GET",a,!0),d.onreadystatechange=function(){d.readyState===4&&b(d.responseText)},d.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=b.nodeRequire("fs"),c.get=function(a,b){var c=l.readFileSync(a,"utf8");c.indexOf("")===0&&(c=c.substring(1)),b(c)}):typeof Packages!="undefined"&&(c.get=function(a,b){var c=new java.io.File(a),d=java.lang.System.getProperty("line.separator"),c=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(c),"utf-8")),e,f,g="";try{e=new java.lang.StringBuffer,(f=c.readLine())&&f.length()&&f.charAt(0)===65279&&(f=f.substring(1));for(e.append(f);(f=c.readLine())!==null;)e.append(d),e.append(f);g=String(e.toString())}finally{c.close()}b(g)}),c})}(),c("text!default-config.json",[],function(){return'{\n  "name": "default-config",\n  "baseDir": "../",\n  "snapshotHTMLOnReady": true,\n  "scrapePage": true,\n  "title": "Popcorn Maker",\n  "ui": {\n    "enabled": true,\n    "trackEventHighlight": "click"\n  },\n  "mediaDefaults": {\n    "frameAnimation": true\n  },\n  "plugin": {\n    "plugins": [\n      {\n        "type": "attribution",\n        "path": "{{baseDir}}external/popcorn-js/plugins/attribution/popcorn.attribution.js"\n      },\n      {\n        "type": "webpage",\n        "path": "{{baseDir}}external/popcorn-js/plugins/webpage/popcorn.webpage.js"\n      },\n      {\n        "type": "text",\n        "path": "{{baseDir}}external/popcorn-js/plugins/text/popcorn.text.js"\n      },\n      {\n        "type": "googlemap",\n        "path": "{{baseDir}}external/popcorn-js/plugins/googlemap/popcorn.googlemap.js"\n      },\n      {\n        "type": "image",\n        "path": "{{baseDir}}external/popcorn-js/plugins/image/popcorn.image.js"\n      },\n      {\n        "type": "twitter",\n        "path": "{{baseDir}}external/popcorn-js/plugins/twitter/popcorn.twitter.js"\n      },\n      {\n        "type": "wikipedia",\n        "path": "{{baseDir}}external/popcorn-js/plugins/wikipedia/popcorn.wikipedia.js"\n      }\n    ],\n    "defaults": [\n      "text",\n      "image",\n      "googlemap"\n    ]\n  },\n  "player": {\n    "players": [\n      {\n        "type": "youtube",\n        "path": "{{baseDir}}external/popcorn-js/players/youtube/popcorn.youtube.js"\n      },\n      {\n        "type": "soundcloud",\n        "path": "{{baseDir}}external/popcorn-js/players/soundcloud/popcorn.soundcloud.js"\n      },\n      {\n        "type": "vimeo",\n        "path": "{{baseDir}}external/popcorn-js/players/vimeo/popcorn.vimeo.js"\n      }\n    ],\n    "defaults": [\n      "youtube",\n      "soundcloud",\n      "vimeo"\n    ]\n  },\n  "dirs": {\n    "popcorn-js": "{{baseDir}}external/popcorn-js/",\n    "css": "{{baseDir}}css/",\n    "resources": "{{baseDir}}resources/"\n  },\n  "icons": {\n    "default": "popcorn-icon.png",\n    "image": "image-icon.png"\n  }\n}\n'}),c("text!layouts/ua-warning.html",[],function(){return'<div class="butter-ua-warning" data-butter-exclude>Your web browser may lack some functionality expected by Butter to function properly. Please upgrade your browser or <a href="https://webmademovies.lighthouseapp.com/projects/65733-popcorn-maker">file a bug</a> to find out why your browser isn\'t fully supported. Click <a href="#" class="close-button">here</a> to remove this warning.</div>'}),c("text!layouts/media-view.html",[],function(){return'<div class="butter-media-properties" data-butter-exclude="true">\n  <p class="butter-edit-message">Edit source...</p>\n  <div class="butter-container">\n    <div class="butter-inner-container">\n      <div class="butter-inner-container-title">Video/Audio URL</div>\n      <div class="butter-url-group">\n        <div class="butter-url fade-in"><input type="text" /><button class="butter-btn butter-btn-remove"><span class="icon-minus"></span></button></div>\n      </div>\n      <p class="butter-form-field-notes"></p>\n      <button class="butter-btn butter-btn-save">Save</button><button class="butter-btn butter-btn-add-url">Add Alternate URL</button>\n      <div class="butter-loading-container"></div>\n    </div>\n  </div>\n</div>'}),c("core/views/media-view",["ui/page-element","ui/logo-spinner","util/lang","ui/widget/textbox","text!layouts/media-view.html"],function(a,b,c,d,e){var f="Supports HTML5 video and YouTube",g=300,h=4;return function(i,j){function A(){n&&!o&&(B(!1),q.classList.remove("open"))}function B(a){a?(n=!1,q.style.width=z.width+"px",q.style.height=z.height+"px"):(q.style.width="",q.style.height="")}function C(a){d(a),a.addEventListener("blur",function(a){o=!1,A()},!1),a.addEventListener("focus",function(a){o=!0},!1)}function D(){var a=s.cloneNode(!0);a.classList.remove("fade-in"),x.appendChild(a),setTimeout(function(){a.classList.add("fade-in")},0),z&&(z.width=r.clientWidth,z.height=r.clientHeight,B(!0)),a.querySelector("button.butter-btn-remove").addEventListener("click",function(b){E(a)},!1),C(a.querySelector("input[type='text']")),x.querySelectorAll("input[type='text']").length>=h&&(w.style.visibility="hidden")}function E(a){x.removeChild(a),z.width=r.clientWidth,z.height=r.clientHeight,B(!0),x.querySelectorAll("input[type='text']").length<h&&(w.style.visibility="visible")}function F(a,b){a?u.innerHTML=b:u.innerHTML=f}function G(){var a=[],b=r.querySelectorAll("input[type='text']");u.classList.add("form-ok"),u.classList.remove("form-error");for(var c=0,d=b.length;c<d;c++)b[c].classList.add("form-ok"),b[c].classList.remove("form-error"),a.push(b[c].value);i.url=a}function H(a){var b=x.querySelectorAll("input[type='text']");while(b.length<a.length)D(),b=x.querySelectorAll("input[type='text']");while(b.length>a.length)E(b[b.length-1]),b=x.querySelectorAll("input[type='text']");for(var c=0;c<a.length;++c)b[c].value=a[c]}function I(){var a=i.url;if(typeof a=="string")t.value=a;else{if(!a.length)throw"Media url is expected value (not string or array): "+a;H(a)}}function J(a){var b=x.querySelectorAll("button.butter-btn-remove"),c=x.querySelectorAll("input[type='text']");for(var d=0;d<c.length;d++)c[d].disabled=a,b[d].disabled=a;o=a,w.disabled=a}function K(a){var b=a?a.data:l.element.getBoundingClientRect();q.style.left=b.left+"px",q.style.top=b.top+"px"}var k=i,l,m=j.onDropped||function(){},n=!1,o=!1,p,q=c.domFragment(e),r=q.querySelector("div.butter-container"),s=q.querySelector("div.butter-url"),t=q.querySelector("input[type='text']"),u=q.querySelector(".butter-form-field-notes"),v=q.querySelector("button.butter-btn-save"),w=q.querySelector("button.butter-btn-add-url"),x=q.querySelector("div.butter-url-group"),y=q.querySelector(".butter-loading-container"),z;w.addEventListener("click",function(a){D()},!1),C(t),q.addEventListener("mouseover",function(a){a.stopPropagation(),q.classList.add("open"),z||(z={width:r.clientWidth,height:r.clientHeight}),B(!0)},!0),q.addEventListener("mouseout",function(a){setTimeout(function(){A()},g),n=!0},!1),p=b(y),u.innerHTML=f,t.addEventListener("keypress",function(a){a.which===13&&G()},!1),v.addEventListener("click",G,!1),p.start(),v.setAttribute("disabled",!0),i.listen("mediacontentchanged",function(a){I(),F(!1),v.setAttribute("disabled",!0),J(!0),p.start()}),i.listen("mediafailed",function(a){F(!0,"Media failed to load. Check your URL."),v.removeAttribute("disabled"),J(!1),t.className+=" form-error",u.className+=" form-error",p.stop()}),i.listen("mediaready",function(a){F(!1),v.removeAttribute("disabled"),J(!1),p.stop()}),this.blink=function(){l.blink()},this.destroy=function(){l.destroy(),l=null},this.update=function(){I();var b=document.getElementById(k.target);l&&l.destroy(),l=new a(k.target,{drop:function(a){m(a)}},{highlightClass:"butter-media-highlight"}),b&&(q.parentNode||document.body.appendChild(q),l.listen("moved",K),K())}}}),function(){c("core/media",["core/logger","core/eventmanager","core/track","core/popcorn-wrapper","core/views/media-view"],function(a,b,c,d,e){var f=500,g=10,h=0,i=function(i){function y(a){w.dispatch("trackeventrequested",a)}function z(a){var b=a.data;x.updateEvent(b),b._popcornWrapper=x}function A(a){var b=a.data;x.destroyEvent(b),b._popcornWrapper=null}function B(){n&&n.indexOf(",")>-1&&(n=n.split(",")),n&&p&&x.prepare(n,p,t,w.popcornCallbacks,w.popcornScripts),v&&v.update()}function C(a){var b="";if(a.children){var c=a.children;b=[];for(var d=0,e=c.length;d<e;d++)c[d].nodeName==="SOURCE"&&b.push(c[d].src)}return b.length?b:a.currentSrc}i=i||{},b(this);var j=[],k="Media"+h++,l=new a(k),m=i.name||k,n=i.url,o=!1,p=i.target,q,r=0,s=-1,t=i.popcornOptions,u,v,w=this,x=new d(k,{popcornEvents:{muted:function(){w.dispatch("mediamuted",w)},unmuted:function(){w.dispatch("mediaunmuted",w)},volumechange:function(){w.dispatch("mediavolumechange",x.volume)},timeupdate:function(){r=x.currentTime,w.dispatch("mediatimeupdate",w)},pause:function(){clearInterval(u),w.dispatch("mediapause")},playing:function(){u=setInterval(function(){r=x.currentTime},10),w.dispatch("mediaplaying")},ended:function(){w.dispatch("mediaended")}},prepare:function(){w.duration=x.duration,o=!0;for(var a=0,b=j.length;a<b;a++){var c=j[a].trackEvents;for(var d=0,e=c.length;d<e;d++)c[d].update()}v&&v.update();var f=document.getElementById(p);f&&f.getAttribute("data-butter-media-controls")&&x.popcorn.controls(!0),w.dispatch("mediaready")},constructing:function(){v&&v.update()},timeout:function(){w.dispatch("mediatimeout"),w.dispatch("mediafailed","timeout")},fail:function(a){w.dispatch("mediafailed","error")},playerTypeRequired:function(a){w.dispatch("mediaplayertyperequired",a)},setup:{target:p,url:n}});this.popcornCallbacks=null,this.popcornScripts=null,this.createView=function(){v||(v=new e(this,{onDropped:y}))},this.destroy=function(){x.unbind(),v&&v.destroy()},this.clear=function(){while(j.length>0)w.removeTrack(j[0])},this.addTrack=function(a){a instanceof c||(a=new c(a)),a.order=j.length,a._media=w,j.push(a),w.chain(a,["tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventselected","trackeventdeselected"]),a.listen("trackeventadded",z),a.listen("trackeventremoved",A),w.dispatch("trackadded",a),a.setPopcornWrapper(x);var b=a.trackEvents;if(b.length>0)for(var d=0,e=b.length;d<e;++d)a.dispatch("trackeventadded",b[d]);return a},this.getTrackById=function(a){for(var b=0,c=j.length;b<c;++b)if(j[b].id===a)return j[b]},this.removeTrack=function(a){var b=j.indexOf(a);if(b>-1){j.splice(b,1);var c=a.trackEvents;for(var d=0,e=c.length;d<e;++d)c[d].selected=!1,a.dispatch("trackeventremoved",c[d]);return w.unchain(a,["tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventselected","trackeventdeselected"]),a.setPopcornWrapper(null),a.unlisten("trackeventadded",z),a.unlisten("trackeventremoved",A),w.dispatch("trackremoved",a),a._media=null,a}},this.findTrackWithTrackEventId=function(a){for(var b=0,c=j.length;b<c;++b){var d=j[b].getTrackEventById(a);if(d)return{track:j[b],trackEvent:d}}},this.getManifest=function(a){return q[a]},this.setupContent=B,this.onReady=function(a){function b(c){a(c),w.unlisten("mediaready",b)}o?a():w.listen("mediaready",b)},this.pause=function(){x.pause()},this.play=function(){x.play()},this.generatePopcornString=function(a,b){var c=t||{};a=a||w.popcornCallbacks,b=b||w.popcornScripts;var d=[];for(var e=0,f=j.length;e<f;++e)d=d.concat(j[e].trackEvents);return c.frameAnimation=!1,x.generatePopcornString(c,n,p,null,a,b,d)},Object.defineProperties(this,{ended:{enumerable:!0,get:function(){return x.popcorn?x.popcorn.ended():!1}},url:{enumerable:!0,get:function(){return n},set:function(a){n!==a&&(n=a,x.clear(p),B(),w.dispatch("mediacontentchanged",w))}},target:{get:function(){return p},set:function(a){p!==a&&(x.clear(p),p=a,B(),w.dispatch("mediatargetchanged",w))},enumerable:!0},muted:{enumerable:!0,get:function(){return x.muted},set:function(a){x.muted=a}},ready:{enumerable:!0,get:function(){return o}},name:{get:function(){return m},enumerable:!0},id:{get:function(){return k},enumerable:!0},tracks:{get:function(){return j},enumerable:!0},currentTime:{get:function(){return r},set:function(a){a!==undefined&&(r=a,r<0&&(r=0),r>s&&(r=s),x.currentTime=r,w.dispatch("mediatimeupdate",w))},enumerable:!0},duration:{get:function(){return s},set:function(a){a&&(s=a,l.log("duration changed to "+s),w.dispatch("mediadurationchanged",w))},enumerable:!0},json:{get:function(){var a=[];for(var b=0,c=j.length;b<c;++b)a.push(j[b].json);return{id:k,name:m,url:n,target:p,duration:s,controls:x.popcorn?x.popcorn.controls():!1,tracks:a}},set:function(a){a.name&&(m=a.name),a.target&&(w.target=a.target),a.url&&(w.url=a.url);if(a.tracks){var b=a.tracks;for(var d=0,e=b.length;d<e;++d){var f=new c;f.json=b[d],w.addTrack(f)}}},enumerable:!0},registry:{get:function(){return q},set:function(a){q=a},enumerable:!0},popcorn:{enumerable:!0,get:function(){return x}},paused:{enumerable:!0,get:function(){return x.paused},set:function(a){x.paused=a}},volume:{enumerable:!0,get:function(){return x.volume},set:function(a){x.volume=a}},view:{enumerable:!0,get:function(){return v}},popcornOptions:{enumerable:!0,get:function(){return t},set:function(a){t=a,w.dispatch("mediapopcornsettingschanged",w),B()}}});var D=document.getElementById(p),E=n,F=0,G;D&&["VIDEO","AUDIO"].indexOf(D.nodeName)>-1&&(E=E||C(D),E?n=E:G=setInterval(function(){E=C(D),E?(n=E,B(),clearInterval(G)):F++===g&&clearInterval(G)},f))};return i})}(),c("text!layouts/editor-area.html",[],function(){return'<div class="butter-editor-area">\n</div>'}),c("text!layouts/toggler.html",[],function(){return'<div class="butter-toggle-button">\n	<div class="image-container"></div>\n</div>'}),c("ui/toggler",["util/lang","text!layouts/toggler.html"],function(a,b){return function(c,d,e){var f=a.domFragment(b);e!==!1&&e!==!0&&(e=!1),f.title=d||"Show/Hide",c&&f.addEventListener("click",c,!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return f}},state:{enumerable:!0,get:function(){return f.classList.contains("toggled")},set:function(a){a?f.classList.add("toggled"):f.classList.remove("toggled")}},visible:{enumerable:!0,get:function(){return f.style.display!=="none"},set:function(a){f.style.display=a?"block":"none"}}}),this.state=e}}),c("text!editor/default.html",[],function(){return'<!--  This Source Code Form is subject to the terms of the MIT license\n      If a copy of the MIT license was not distributed with this file, you can\n      obtain one at http://www.mozillapopcorn.org/butter-license.txt -->\n\n<div class="butter-editor">\n  <h1>Track Event Editor</h1>\n  <div class="error-message-container">\n    <div class="error-message"></div>\n  </div>\n</div>\n'}),c("text!dialog/dialogs/error-message.html",[],function(){return'<!--  This Source Code Form is subject to the terms of the MIT license\n      If a copy of the MIT license was not distributed with this file, you can\n      obtain one at http://www.mozillapopcorn.org/butter-license.txt -->\n\n<div class="butter-dialog">\n  <div class="container" class="hbox center">\n    <div class="vbox center">\n      <h1><span class="message">Error</span></h1>\n    </div>\n  </div>\n  <div class="close-button"></div>\n</div>\n'}),c("dialog/dialogs/error-message",["text!dialog/dialogs/error-message.html","dialog/dialog"],function(a,b){b.register("error-message",a,function(a,b){var c=a.rootElement.querySelector(".message");c.innerHTML=b,a.enableCloseButton(),a.assignEscapeKey("default-close"),a.assignEnterKey("default-ok")})}),c("text!dialog/dialogs/track-data.html",[],function(){return'<!--  This Source Code Form is subject to the terms of the MIT license\n      If a copy of the MIT license was not distributed with this file, you can\n      obtain one at http://www.mozillapopcorn.org/butter-license.txt -->\n\n<div class="butter-dialog">\n  <h1>Data for <span class="track-name"></span></h1>\n  <div class="container hbox center">\n    <div class="content vbox center">\n      <textarea class="track-data main-textarea" readonly>Please wait...</textarea>\n    </div>\n  </div>\n  <div class="error"></div>\n  <div class="buttons vbox center">\n    <button class="butter-dialog-button update">Update</button>\n  </div>\n  <div class="close-button"></div>\n</div>\n'}),c("dialog/dialogs/track-data",["text!dialog/dialogs/track-data.html","dialog/dialog"],function(a,b){b.register("track-data",a,function(a,b){var c=a.rootElement,d=c.querySelector(".track-name"),e=c.querySelector(".track-data"),f=b.json;a.listen("error",function(b){a.showError("Invalid JSON")}),a.registerActivity("update",function(b){a.hideError(),a.send("submit",e.value)}),a.assignButton(".update","update"),d.innerHTML=f.name,e.value=JSON.stringify(f),a.enableCloseButton(),a.enableElements(".update"),a.assignEscapeKey("default-close"),a.assignEnterKey("update"),e.removeAttribute("readonly"),e.addEventListener("keyup",function(b){a.hideError()},!1)})}),c("text!dialog/dialogs/delete-track.html",[],function(){return'<!--  This Source Code Form is subject to the terms of the MIT license\n      If a copy of the MIT license was not distributed with this file, you can\n      obtain one at http://www.mozillapopcorn.org/butter-license.txt -->\n\n<div class="butter-dialog small">\n  <div class="container hbox center">\n    <div class="content vbox center">\n      <h1>Are you sure you want to delete <span class="track-name"></span>?</h1>\n    </div>\n  </div>\n  <div class="buttons" class="vbox center">\n    <button class="butter-dialog-button yes">Yes</button>\n    <button class="butter-dialog-button no">No</button>\n  </div>\n  <div class="close-button"></div>\n</div>\n'}),c("dialog/dialogs/delete-track",["text!dialog/dialogs/delete-track.html","dialog/dialog"],function(a,b){b.register("delete-track",a,function(a,b){a.registerActivity("ok",function(b){a.send("submit",!0)}),a.rootElement.querySelector(".track-name").appendChild(document.createTextNode(b)),a.enableElements(".yes",".no"),a.enableCloseButton(),a.assignEscapeKey("default-close"),a.assignEnterKey("ok"),a.assignButton(".yes","ok"),a.assignButton(".no","default-close")})}),c("text!dialog/dialogs/export.html",[],function(){return'<!--  This Source Code Form is subject to the terms of the MIT license\n      If a copy of the MIT license was not distributed with this file, you can\n      obtain one at http://www.mozillapopcorn.org/butter-license.txt -->\n\n<div class="butter-dialog">\n  <h1><span class="title"></span></h1>\n  <div class="container hbox center">\n    <div class=" vbox center">\n      <textarea class="json-export main-textarea" readonly>Please wait...</textarea>\n      <textarea class="html-export main-textarea" readonly>Please wait...</textarea>\n    </div>\n  </div>\n  <div class="buttons vbox center">\n    <button class="json-button butter-dialog-button button-blue">Get JSON</button>\n    <button class="html-button butter-dialog-button button-blue">Get HTML</button>\n  </div>\n  <div class="close-button"></div>\n</div>\n'}),c("dialog/dialogs/export",["text!dialog/dialogs/export.html","dialog/dialog"],function(a,b){b.register("export",a,function(a,b){var c=a.rootElement,d=c.querySelector(".json-button"),e=c.querySelector(".html-button"),f=c.querySelector(".json-export"),g=c.querySelector(".html-export"),h=c.querySelector(".title");h.innerHTML="HTML Export",d.addEventListener("click",function(b){h.innerHTML="Project JSON Data",g.style.display="none",f.style.display="block",a.disableElements(".json-button"),a.enableElements(".html-button")},!1),e.addEventListener("click",function(b){h.innerHTML="HTML Export",g.style.display="block",f.style.display="none",a.disableElements(".html-button"),a.enableElements(".json-button")},!1);try{f.value=JSON.stringify(b.json,null,2)}catch(i){f.value="There was an error trying to parse the JSON blob for this project. Please file a bug at https://webmademovies.lighthouseapp.com/projects/65733-butter/ and let us know."}g.value=b.html,a.enableCloseButton(),a.assignEscapeKey("default-close"),a.assignEnterKey("default-close"),a.disableElements(".html-button")})}),c("text!dialog/dialogs/quit-confirmation.html",[],function(){return'<!--  This Source Code Form is subject to the terms of the MIT license\n      If a copy of the MIT license was not distributed with this file, you can\n      obtain one at http://www.mozillapopcorn.org/butter-license.txt -->\n\n<div class="butter-dialog">\n  <div class="container hbox center">\n    <div class="content vbox center">\n      <h1>Are you sure you want to leave?</h1>\n    </div>\n  </div>\n  <div class="buttons hbox center">\n    <button class="butter-dialog-button yes">Yes</button>\n    <button class="butter-dialog-button no">No</button>\n  </div>\n  <div class="close-button" />\n</div>\n'}),c("dialog/dialogs/quit-confirmation",["text!dialog/dialogs/quit-confirmation.html","dialog/dialog"],function(a,b){b.register("quit-confirmation",a,function(a){a.assignButton(".yes","default-ok"),a.assignButton(".no","default-close"),a.assignEnterKey("default-ok"),a.assignEscapeKey("default-close"),a.enableCloseButton()})}),c("text!dialog/dialogs/save-as.html",[],function(){return'<!--  This Source Code Form is subject to the terms of the MIT license\n      If a copy of the MIT license was not distributed with this file, you can\n      obtain one at http://www.mozillapopcorn.org/butter-license.txt -->\n\n<div class="butter-dialog small">\n  <h1>Please give your project a<span class="better"> better</span> name:</h1>\n  <div class="container hbox center">\n    <div class="content vbox center">\n      <input type="text" class="name-input" />\n    </div>\n  </div>\n  <div class="buttons hbox center">\n    <button class="butter-dialog-button save">Save</button>\n  </div>\n  <div class="close-button"></div>\n</div>\n'}),c("dialog/dialogs/save-as",["text!dialog/dialogs/save-as.html","dialog/dialog"],function(a,b){b.register("save-as",a,function(a,b){var c=a.rootElement.querySelector(".name-input");a.registerActivity("save",function(b){c.value.replace(/\s/g,"")!==""?a.send("submit",c.value):a.rootElement.querySelector(".better").style.display="inline"}),a.enableCloseButton(),a.assignEscapeKey("default-close"),a.assignEnterKey("save"),a.assignButton(".save","save"),c.value=b||""})}),c("text!dialog/dialogs/share.html",[],function(){return'<!--  This Source Code Form is subject to the terms of the MIT license\n      If a copy of the MIT license was not distributed with this file, you can\n      obtain one at http://www.mozillapopcorn.org/butter-license.txt -->\n\n<div class="butter-dialog share small">\n  <h1>Share URL:</h1>\n  <div class="container hbox center">\n    <div class="content vbox center">\n      <div class="url">\n        <span>Please wait...</span><a target="_blank" href="#" class="url-text"></a>\n      </div>\n    </div>\n  </div>\n  <div class="close-button"></div>\n</div>\n'}),c("dialog/dialogs/share",["text!dialog/dialogs/share.html","dialog/dialog"],function(a,b){b.register("share",a,function(a,b){var c=a.rootElement.querySelector(".url-text"),d=a.rootElement.querySelector(".url");d.removeChild(d.querySelectorAll("span")[0]),c.innerHTML=b,c.href=b,a.enableCloseButton(),a.assignEscapeKey("default-close"),a.assignEnterKey("default-close")})}),c("dialogs",["dialog/dialogs/error-message","dialog/dialogs/track-data","dialog/dialogs/delete-track","dialog/dialogs/export","dialog/dialogs/quit-confirmation","dialog/dialogs/save-as","dialog/dialogs/share"],function(){}),c("text!layouts/trackevent-editor-defaults.html",[],function(){return'<!--  This Source Code Form is subject to the terms of the MIT license\n      If a copy of the MIT license was not distributed with this file, you can\n      obtain one at http://www.mozillapopcorn.org/butter-license.txt -->\n\n<div class="trackevent-property default input">\n  <div class="property-name"></div>\n  <input class="value" type="text" />\n</div>\n\n<div class="trackevent-property select">\n  <div class="property-name"></div>\n  <select>\n  </select>\n</div>\n\n<div class="trackevent-property targets">\n  <div class="property-name">Target</div>\n  <select data-manifest-key="target">\n    <option class="default-target-option" value="Media Element">Media Element</option>\n  </select>\n</div>'}),c("editor/editor",["core/eventmanager","util/lang","util/xhr","util/keys","text!layouts/trackevent-editor-defaults.html"],function(a,b,c,d,e){var f={},g=b.domFragment(e),h=[d.LEFT,d.UP,d.RIGHT,d.DOWN,d.DELETE,d.TAB,d.ESCAPE],i={BaseEditor:function(b,c,d,e){a(b),b.butter=c,b.rootElement=d,b.parentElement=null,b.open=function(a){b.parentElement=a,e.open&&e.open.apply(b,arguments),b.parentElement.appendChild(b.rootElement),b.dispatch("open")},b.close=function(){b.rootElement.parentNode.removeChild(b.rootElement),e.close&&e.close.apply(b,arguments),b.dispatch("closed")},b.defaultLayouts=g.cloneNode(!0),b.createTargetsList=function(a){var b=g.querySelector(".trackevent-property.targets").cloneNode(!0),c=b.querySelector("select"),d=c.firstChild,e;for(var f=1;f<a.length;++f)e=document.createElement("option"),e.value=a[f].element.id,e.innerHTML=a[f].element.id,d?c.insertBefore(e,d):c.appendChild(e);return b},b.attachSelectChangeHandler=function(a,c,d){a.addEventListener("change",function(e){var f={};f[d]=a.value,c.update(f);var g=b.butter.getTargetByType("elementID",c.popcornOptions.target);g?g.view.blink():b.butter.currentMedia.view.blink()},!1)},b.attachStartEndHandler=function(a,b,c,d){a.addEventListener("blur",function(e){var f={};f[c]=a.value,d(b,f)},!1),a.addEventListener("keyup",function(e){if(h.indexOf(e.which)>-1)return;var f=a.value.replace(/\s/g,"");if(f&&f.length>0){var g={};g[c]=f,f.charAt(f.length-1)!=="."&&d(b,g)}},!1)},b.attachCheckboxChangeHandler=function(a,b,c){a.addEventListener("click",function(d){var e={};e[c]=a.checked,b.update(e)},!1)},b.attachInputChangeHandler=function(a,b,c){a.addEventListener("blur",function(d){var e={};e[c]=a.value,b.update(e)},!1),a.addEventListener("keyup",function(d){if(h.indexOf(d.which)>-1)return;var e={};e[c]=a.value,b.update(e)},!1)},b.createManifestItem=function(a,b,c,d,e){var f=b.elem||"default",h=g.querySelector(".trackevent-property."+f).cloneNode(!0),i,j=b.label||a,k,l,m;j==="In"?j="Start (seconds)":j==="Out"&&(j="End (seconds)"),h.querySelector(".property-name").innerHTML=j;if(b.elem==="select"){i=h.querySelector("select"),i.setAttribute("data-manifest-key",a);if(b.options)for(l=0,m=b.options.length;l<m;++l)k=document.createElement("option"),k.value=k.innerHTML=b.options[l],i.appendChild(k)}else{i=h.querySelector("input");if(c){if(c===undefined||typeof c=="object")b.default?c=b.default:c=b.type==="number"?0:"";i.value=c}i.type=b.type,i.setAttribute("data-manifest-key",a)}return e&&e(b.elem,i,d,a),h},b.updatePropertiesFromManifest=function(a,c,d){var e,f=a.popcornOptions,g=a.manifest.options,h,i,j;c=c||Object.keys(g),d&&c.indexOf("target")===-1&&(c=c.concat("target"));for(i=0,j=c.length;i<j;++i)h=c[i],e=b.rootElement.querySelector("[data-manifest-key='"+h+"']"),e&&(e.type==="checkbox"?e.checked=f[h]:e.value=f[h])},b.createPropertiesFromManifest=function(a,c,d,e,f){var g,h,i,j,k;e=e||b.rootElement;if(!a.manifest)throw"Unable to create properties from null manifest. Perhaps trackevent is not initialized properly yet.";g=a.manifest.options,d=d||Object.keys(g);for(j=0,k=d.length;j<k;++j){h=d[j];if(f&&f.indexOf(h)>-1)continue;i=b.createManifestItem(h,g[h],a.popcornOptions[h],a,c),e.appendChild(i)}}},register:function(a,b,c){f[a]={create:c,layout:b}},create:function(a,c){var d=f[a],e=b.domFragment(d.layout);e.classList||(e=e.querySelector(".butter-editor"));if(!e)throw new Error("Editor layout not formatted properly.");return new d.create(e,c)},isRegistered:function(a){return!!f[a]},loadLayout:function(a,b){a.indexOf("{{baseDir}}")>-1&&(a=a.replace("{{baseDir}}",i.baseDir)),c.get(a,function(a){a.target.readyState===4&&b(a.target.responseText)},"text/plain")},baseDir:null};return i}),c("editor/default",["text!./default.html","editor/editor"],function(a,b){b.register("default",a,function(a,c){function i(a){a?(h.innerHTML=a,h.parentNode.style.height=h.offsetHeight+"px",h.parentNode.style.visibility="visible",h.parentNode.classList.add("open")):(h.innerHTML="",h.parentNode.style.height="",h.parentNode.style.visibility="",h.parentNode.classList.remove("open"))}function j(a){d.updatePropertiesFromManifest(a.target),i(!1)}function k(a,b){a.update(b)}function l(a,b){try{a.update(b)}catch(c){i(c.toString())}}var d=this,e=a,f,g=[c.currentMedia].concat(c.targets),h=e.querySelector("div.error-message");b.BaseEditor(d,c,a,{open:function(a,b){var c,h;f=b,d.createPropertiesFromManifest(b,function(a,b,c,e){a==="select"?d.attachSelectChangeHandler(b,c,e,k):["start","end"].indexOf(e)>-1?d.attachStartEndHandler(b,c,e,l):b.type==="checkbox"?d.attachCheckboxChangeHandler(b,c,e,k):d.attachInputChangeHandler(b,c,e,k)},null,null,["target"]),c=d.createTargetsList(g),h=c.querySelector("select"),d.attachSelectChangeHandler(h,b,"target"),e.appendChild(c),d.updatePropertiesFromManifest(b,null,!0),b.listen("trackeventupdated",j)},close:function(){f.unlisten("trackeventupdated",j)}})})}),c("editor/module",["core/eventmanager","core/trackevent","./editor","ui/toggler","util/lang","text!layouts/editor-area.html","./default"],function(a,b,c,d,e,f,g){function h(g,h){function n(a){j||(j=!0,k.classList.remove("minimized"),l.state=!1);var b=c.isRegistered(a.type)?a.type:"default";return i&&i.close(),i=c.create(b,g),i.open(k,a),i}h=h||{};var i,j=!1,k=e.domFragment(f),l,m=this;a(m),g.listen("trackeventcreated",function(a){["target","media"].indexOf(a.data.by)>-1&&g.ui.contentState==="timeline"&&n(a.data.trackEvent)}),this.edit=function(a){if(!!a&&a instanceof b)return n(a);throw new Error("trackEvent must be valid to start an editor.")},g.listen("trackeventadded",function(a){var b=a.data,c=function(a){g.selectedEvents.length===1&&!b.dragging&&n(b)},d=function(a){k.classList.remove("minimized"),l.state=!1};b.view.element.addEventListener("mouseup",c,!0),b.view.element.addEventListener("dblclick",d,!1),g.listen("trackeventremoved",function(a){a.data===b&&(b.view.element.removeEventListener("mouseup",c,!0),b.view.element.removeEventListener("dblclick",d,!1))})}),this._start=function(a){a();if(g.config.value("ui").enabled!==!1){g.ui.areas.editor=new g.ui.Area("editor-area",k),l=new d(function(a){var b=!k.classList.contains("minimized");l.state=b,b?k.classList.add("minimized"):k.classList.remove("minimized")},"Show/Hide Editor",!0),k.appendChild(l.element),document.body.classList.add("butter-editor-spacing"),k.classList.add("minimized"),document.body.appendChild(k);var b=g.config.value("editor");for(var c in b)b.hasOwnProperty(c)&&g.loader.load({url:b[c],type:"js"})}}}return this.register=c.register,h.__moduleName="editor",h}),c("modules",["editor/module","timeline/module","cornfield/module","plugin/module"],function(){var a=Array.prototype.slice.apply(arguments);return function(b,c,d){var e=[],f=0,g=0;for(var h=0;h<a.length;++h){var i=a[h].__moduleName;b[i]=new a[h](b,c.value(i)),e.push(b[i])}return{load:function(a){function b(){f++,f===e.length&&a()}for(var c=0;c<e.length;++c)e[c]._load?e[c]._load(b):f++;f===e.length&&a()},ready:function(a){function b(){g++,g===e.length&&a()}for(var c=0;c<e.length;++c)e[c]._start?e[c]._start(b):g++}}}}),c("text!layouts/header.html",[],function(){return'<div id="butter-header" data-butter-exclude>\n  <div class="butter-header-inner">\n    <div class="butter-logo"></div>\n    <span class="butter-name"></span>\n    <div class="butter-editor-actions">\n      <a class="butter-btn" href="/dashboard" id="butter-header-load" title="Manage your projects"><span class="icon-grear-sign"></span> Projects</a>\n      <a class="butter-btn" href="#" id="butter-header-save" title="Save your project"><span class="icon-ok-sign"></span> Save</a>\n      <a class="butter-btn" href="#" id="butter-header-source" title="View the source of this template"><span class="icon-eye-open"></span> View Source</a>\n      <a class="butter-btn" href="#" id="butter-header-share" title="Generate a link to share this project with the world"><span class="icon-share-alt"></span> Publish</a>\n      <a class="butter-btn" href="#" id="butter-header-auth" title="Sign in or sign up with Persona"><span class=\'icon-user\'></span>Sign In / Sign Up</a>\n    </div>\n  </div>\n</div>\n'}),c("ui/header",["dialog/dialog","util/lang","text!layouts/header.html"],function(a,b,c){var d="<span class='icon-user'></span> Sign In / Sign Up",e="Sign in or sign up with Persona";return function(f,g){function n(a,b){if(f.cornfield.authenticated()&&a&&typeof a=="function"){a();return}f.cornfield.login(function(c){c.error?(o("There was an error logging in. Please try again."),b&&b()):f.cornfield.list(function(b){r(),a&&typeof a=="function"&&a()})})}function o(b,c){var d=a.spawn("error-message",{data:b,events:{cancel:function(a){d.close(),c&&c()}}});d.open()}function p(b){function c(){f.project.data=f.exportProject();var a=JSON.stringify(f.project,null,4);f.ui.loadIndicator.start(),f.cornfield.save(f.project.id,a,function(a){f.ui.loadIndicator.stop();if(a.error!=="okay"||!a.project||!a.project._id){o("There was a problem saving your project. Please try again.");return}f.project.id=a.project._id,b&&b(),f.dispatch("projectsaved")})}if(!f.project.name){var d=a.spawn("save-as",{events:{submit:function(a){f.project.name=a.data,d.close(),c()}}});d.open()}else c()}function q(){f.cornfield.logout(s)}function r(){m.removeEventListener("click",n,!1),m.innerHTML="<span class='icon-user'></span> "+f.cornfield.name(),m.title="This is you!",m.addEventListener("click",q,!1)}function s(){m.removeEventListener("click",q,!1),m.innerHTML=d,m.title=e,m.addEventListener("click",n,!1)}g=g||{};var h=b.domFragment(c),i,j,k,l,m;i=h.querySelector(".butter-name"),i.innerHTML=g.value("title")||"Popcorn Maker",h=document.body.insertBefore(h,document.body.firstChild),j=document.getElementById("butter-header-save"),k=document.getElementById("butter-header-source"),l=document.getElementById("butter-header-share"),m=document.getElementById("butter-header-auth"),document.body.classList.add("butter-header-spacing"),k.addEventListener("click",function(b){var c={html:f.getHTML(),json:f.exportProject()};a.spawn("export",{data:c}).open()},!1),m.addEventListener("click",n,!1),l.addEventListener("click",function(b){function c(){f.cornfield.publish(f.project.id,function(b){if(b.error!=="okay"){o("There was a problem saving your project. Please try again.");return}var c=b.url;a.spawn("share",{data:c}).open()})}function d(){p(c)}n(d)},!1),j.addEventListener("click",function(a){n(p)},!1),f.cornfield.authenticated()?r():(s(),f.listen("autologinsucceeded",function t(a){f.unlisten("autologinsucceeded",t),r()}))}}),c("ui/ui",["core/eventmanager","./toggler","./logo-spinner","./context-button","./header","./unload-dialog"],function(a,b,c,d,e,f){function i(b,c){var d,e=[],f=this;a(f),this.element=d=c||document.createElement("div"),d.id=b,this.items={},this.addComponent=function(a,b){var c=new j(a,b);e.push(c),d.appendChild(c.element)},this.setContentState=function(a){for(var b=0,c=e.length;b<c;++b)e[b].setState(a)}}function j(a,b){b=b||{};var c=b.transitionIn||function(){},d=b.transitionInComplete||function(){},e=b.transitionOut||function(){},f=b.transitionOutComplete||function(){},h=b.states||[],i=!1;this.element=a,this.setState=function(a){(!h||h.indexOf(a)>-1)&&!i?(i=!0,c(),setTimeout(d,g)):i&&(e(),setTimeout(f,g),i=!1)}}function k(a,b){var c,d,e;for(c in a)a.hasOwnProperty(c)&&(d=new Image,d.id=c+"-icon",d.src=b+a[c],e=document.createElement("div"),e.setAttribute("data-butter-exclude","true"),e.className="butter-image-preload",e.appendChild(d),document.body.appendChild(e))}function o(j){var o={},p=[],q=!0,r,s=j.config,t=this;a(t),f(j),t.Area=i,o.main=new i("butter-tray"),this.contentStateLocked=!1;var u=o.main.element,v=new b(function(a){j.ui.visible=!j.ui.visible,v.state=j.ui.visible},"Show/Hide Timeline");u.setAttribute("data-butter-exclude","true"),u.className="butter-tray",u.appendChild(v.element),o.work=new i("work"),o.statusbar=new i("status-bar"),o.tools=new i("tools");var w=document.createElement("div");w.id="butter-loading-container",r=c(w),u.appendChild(w),u.appendChild(o.statusbar.element),u.appendChild(o.work.element),u.appendChild(o.tools.element),s.value("ui").enabled!==!1&&(document.body.classList.add("butter-header-spacing"),document.body.classList.add("butter-tray-spacing"),document.body.appendChild(u),j.listen("mediaadded",function(a){a.data.createView()})),this.load=function(a){s.value("ui").enabled!==!1?j.loader.load([{type:"css",url:h}],function(){k(s.value("icons"),s.value("dirs").resources||""),a()}):a()},this.registerStateToggleFunctions=function(a,b){t.listen("contentstatechanged",function(c){c.data.oldState===a&&b.transitionOut(c),c.data.newState===a&&b.transitionIn(c)})},this.pushContentState=function(a){if(t.contentStateLocked)return;var b=t.contentState;p.push(a),u.setAttribute("data-butter-content-state",t.contentState);for(var c in o)o.hasOwnProperty(c)&&o[c].setContentState(a);t.dispatch("contentstatechanged",{oldState:b,newState:t.contentState})},this.popContentState=function(){if(t.contentStateLocked)return;var a=p.pop(),b=t.contentState;u.setAttribute("data-butter-content-state",b);for(var c in o)o.hasOwnProperty(c)&&o[c].setContentState(b);return t.dispatch("contentstatechanged",{oldState:a,newState:b}),a},this.setContentState=function(a){var b=p.pop();p=[a],u.setAttribute("data-butter-content-state",a);for(var c in o)o.hasOwnProperty(c)&&o[c].setContentState(a);return t.dispatch("contentstatechanged",{oldState:b,newState:a}),b},Object.defineProperties(this,{contentState:{configurable:!1,enumerable:!0,get:function(){return p.length>0?p[p.length-1]:null}},element:{configurable:!1,enumerable:!0,get:function(){return u}},areas:{configurable:!1,enumerable:!0,get:function(){return o}},visible:{enumerable:!0,get:function(){return q},set:function(a){q!==a&&(q=a,q?(u.classList.remove("minimized"),t.dispatch("uivisibilitychanged",!0)):(u.classList.add("minimized"),t.dispatch("uivisibilitychanged",!1)))}}});var x=j.orderedTrackEvents=[],y=function(a,b){return a.popcornOptions.start>b.popcornOptions.start};j.listen("trackeventadded",function(a){x.push(a.data),x.sort(y)}),j.listen("trackeventremoved",function(a){var b=x.indexOf(a.data);b>-1&&x.splice(b,1)}),j.listen("trackeventupdated",function(a){x.sort(y)});var z=j.orderedTracks=[],A=function(a,b){return a.order>b.order};j.listen("trackadded",function(a){a.data.listen("trackorderchanged",function(a){z.sort(A)}),z.push(a.data),z.sort(A)}),j.listen("trackremoved",function(a){var b=z.indexOf(a.data);b>-1&&z.splice(b,1)});var B={32:function(a){a.preventDefault(),j.currentMedia.ended?j.currentMedia.paused=!1:j.currentMedia.paused=!j.currentMedia.paused},37:function(a){var b=a.shiftKey?n:m;if(j.selectedEvents.length){a.preventDefault();for(var c=0,d=j.selectedEvents.length;c<d;c++)j.selectedEvents[c].moveFrameLeft(b,a.ctrlKey||a.metaKey)}else j.currentTime-=b},38:function(a){var b,c,d;j.selectedEvents.length&&a.preventDefault();for(var e=0,f=j.selectedEvents.length;e<f;e++)c=j.selectedEvents[e],b=c.track,d=z[z.indexOf(b)-1],d&&(b.removeTrackEvent(c),d.addTrackEvent(c))},39:function(a){a.preventDefault();var b=a.shiftKey?n:m;if(j.selectedEvents.length)for(var c=0,d=j.selectedEvents.length;c<d;c++)j.selectedEvents[c].moveFrameRight(b,a.ctrlKey||a.metaKey);else j.currentTime+=b},40:function(a){var b,c,d;j.selectedEvents.length&&a.preventDefault();for(var e=0,f=j.selectedEvents.length;e<f;e++)c=j.selectedEvents[e],b=c.track,d=z[z.indexOf(b)+1],d&&(b.removeTrackEvent(c),d.addTrackEvent(c))},27:function(a){for(var b=0;b<j.selectedEvents.length;b++)j.selectedEvents[b].selected=!1;j.selectedEvents=[]},8:function(a){if(j.selectedEvents.length){a.preventDefault();for(var b=0;b<j.selectedEvents.length;b++)j.selectedEvents[b].track.removeTrackEvent(j.selectedEvents[b]);j.selectedEvents=[]}},9:function(a){if(x.length&&j.selectedEvents.length<=1){a.preventDefault();var b=0,c=a.shiftKey?-1:1;x.indexOf(j.selectedEvents[0])>-1&&(b=x.indexOf(j.selectedEvents[0]),x[b+c]?b+=c:a.shiftKey?b=x.length-1:b=0);for(var d=0;d<j.selectedEvents.length;d++)j.selectedEvents[d].selected=!1;j.selectedEvents=[],x[b].selected=!0,j.selectedEvents.push(x[b])}}};window.addEventListener("keydown",function(a){var b=a.which||a.keyCode;b=b===46?8:b,B[b]&&l.indexOf(a.target.nodeName)===-1&&B[b](a)},!1),this.TRANSITION_DURATION=g,v.visible=!1,t.visible=!1,this.loadIndicator={start:function(){r.start(),w.style.display="block"},stop:function(){r.stop(function(){w.style.display="none"})}},t.loadIndicator.start(),j.listen("ready",function(){t.loadIndicator.stop(),t.visible=!0,v.visible=!0,d(j),s.value("ui").enabled!==!1&&e(j,s)}),t.dialogDir=j.config.value("dirs").dialogs||""}var g=500,h="{css}/butter.ui.css",l=["TEXTAREA","INPUT","VIDEO","AUDIO"],m=.25,n=1;return o.__moduleName="ui",o}),c("util/shims",[],function(){if("Range"in window&&!Range.prototype.createContextualFragment){var a={getDocument:function(b){if(b.nodeType===9)return b;if(typeof b.ownerDocument!="undefined")return b.ownerDocument;if(typeof b.document!="undefined")return b.document;if(b.parentNode)return this.getDocument(b.parentNode);throw"No document found for node."},isCharacterDataNode:function(a){var b=a.nodeType;return b===3||b===4||b===8},parentElement:function(a){var b=a.parentNode;return b.nodeType===1?b:null},isHtmlNamespace:function(a){var b;return typeof a.namespaceURI=="undefined"||(b=a.namespaceURI)===null||b==="http://www.w3.org/1999/xhtml"},fragmentFromNodeChildren:function(a){var b=this.getDocument(a).createDocumentFragment(),c;while(!!(c=a.firstChild))b.appendChild(c);return b}};Range.prototype.createContextualFragment=function(b){var c=this.startContainer,d=a.getDocument(c);if(!c)throw new DOMException("INVALID_STATE_ERR");var e=null;return c.nodeType===1?e=c:a.isCharacterDataNode(c)&&(e=a.parentElement(c)),e===null||e.nodeName==="HTML"&&a.isHtmlNamespace(a.getDocument(e).documentElement)&&a.isHtmlNamespace(e)?e=d.createElement("body"):e=e.cloneNode(!1),e.innerHTML=b,a.fragmentFromNodeChildren(e)}}typeof document!="undefined"&&!("classList"in document.createElement("a"))&&function(a){var b="classList",c="prototype",d=(a.HTMLElement||a.Element)[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){var b=0,c=this.length;for(;b<c;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(b==="")throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){var b=f.call(a.className),c=b?b.split(/\s+/):[],d=0,e=c.length;for(;d<e;d++)this.push(c[d]);this._updateClassName=function(){a.className=this.toString()}},k=j[c]=[],l=function(){return new j(this)};h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",i(this,a)!==-1},k.add=function(a){a+="",i(this,a)===-1&&(this.push(a),this._updateClassName())},k.remove=function(a){a+="";var b=i(this,a);b!==-1&&(this.splice(b,1),this._updateClassName())},k.toggle=function(a){a+="",i(this,a)===-1?this.add(a):this.remove(a)},k.toString=function(){return this.join(" ")};if(e.defineProperty){var m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(n){n.number===-2146823252&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}(self);return}),function(){var a=1,b=.01,d={Chrome:17,Firefox:10};c("main",["core/eventmanager","core/logger","core/config","core/target","core/media","core/page","./modules","./dependencies","./dialogs","dialog/dialog","editor/editor","ui/ui","util/xhr","util/lang","text!default-config.json","text!layouts/ua-warning.html","util/shims"],function(c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function w(l){function N(){if(!z)throw new Error("No media object is selected")}function O(c,d,e){var f,g=c.getAttribute("data-popcorn-plugin-type"),h=d.currentTime,i;h>d.duration&&(h=d.duration-a),h<0&&(h=0),i=h+a,i>d.duration&&(i=d.duration);if(!g){C.log("Invalid trackevent type requested.");return}d.tracks.length===0&&d.addTrack(),f=d.tracks[0];var j=f.addTrackEvent({type:g,popcornOptions:{start:h,end:i,target:e}});return d.currentTime<d.duration-b&&(d.currentTime+=b),j}function P(a){if(z){var b=O(a.data.element,z,a.target.elementID);H.dispatch("trackeventcreated",{trackEvent:b,by:"target"})}else C.log("Warning: No media to add dropped trackevent.")}function Q(a){D.addPlayerType(a.data)}function R(a){var b=O(a.data,a.target,z.target);H.dispatch("trackeventcreated",{trackEvent:b,by:"media"})}function U(a){var b;window.location.search.substring(1).split("&").forEach(function(a){a=a.split("="),a&&a[0]==="savedDataUrl"&&(b=a[1])}),b=b||E.value("savedDataUrl");if(b){var c=new XMLHttpRequest,d;b+="?noCache="+Date.now(),c.open("GET",b,!1),c.overrideMimeType&&c.overrideMimeType("application/json"),c.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),c.send(null);if(c.status===200){try{d=JSON.parse(c.responseText)}catch(e){H.dispatch("loaddataerror","Saved data not formatted properly.")}H.project.id=d.projectID,H.project.name=d.name,H.importProject(d)}else C.log("Butter saved data not found: "+b)}a()}function V(a){a&&F.merge(a),E=F,H.project.template=E.value("name");var b=j(H,E),c=k(E);H.loader=c,D=new i(c,E),H.ui=new o(H),H.ui.load(function(){T(function(){S(function(){b.ready(function(){E.value("snapshotHTMLOnReady")&&D.snapshotHTML(),U(function(){H.dispatch("ready",H)})})})})})}var n=navigator.userAgent,q;for(var s in d)if(d.hasOwnProperty(s)){var w=new RegExp(s+"/([0-9]+)\\.","g"),x=w.exec(n);x&&x.length===2&&Number(x[1])>=d[s]&&(q=s+"/"+x[1])}q||v.showUAWarning(),l=l||{};var y=[],z,A=[],B="Butter"+t++,C=new e(B),D,E,F,G,H=this,I=[],J={},K={},L={};try{F=f.parse(r)}catch(M){throw"Butter Error: unable to find or parse default-config.json"}l.debug!==undefined&&e.enabled(l.debug),c(H),this.dialog=m,this.project={id:null,name:null,data:null,html:null,template:null,customData:null},Object.defineProperty(this.project,"customData",{get:function(){return K}}),this.getManifest=function(a){return N(),z.getManifest(a)},this.getHTML=function(){var a=[];for(var b=0;b<y.length;++b)a.push(y[b].generatePopcornString());return D.getHTML(a)},this.addTarget=function(a){return a instanceof g||(a=new g(a)),A.push(a),a.listen("trackeventrequested",P),C.log("Target added: "+a.name),H.dispatch("targetadded",a),a.isDefault&&(G=a),a},this.removeTarget=function(a){typeof a=="string"&&(a=H.getTargetByType("id",a));var b=A.indexOf(a);return b>-1?(a.unlisten("trackeventrequested",P),A.splice(b,1),delete A[a.name],H.dispatch("targetremoved",a),G===a&&(G=undefined),a):undefined},this.serializeTargets=function(){var a=[];for(var b=0,c=A.length;b<c;++b)a.push(A[b].json);return a},this.getTargetByType=function(a,b){for(var c=0,d=A.length;c<d;c++)if(A[c][a]===b)return A[c];return undefined},this.importProject=function(a){var b,c;if(a.targets)for(b=0,c=a.targets.length;b<c;++b){var d,e=H.targets,f=a.targets[b];for(var g=0,i=e.length;g<i;++g)if(e[g].name===f.name){d=e[g];break}d?d.json=f:H.addTarget(f)}if(a.media)for(b=0,c=a.media.length;b<c;++b){var j=a.media[b],k=H.getMediaByType("target",j.target);k?k.json=j:(k=new h,k.json=j,H.addMedia(k))}},this.exportProject=function(){var a=[];for(var b=0,c=y.length;b<c;++b)a.push(y[b].json);var d={targets:H.serializeTargets(),media:a};return d},this.clearProject=function(){var a=this.orderedTrackEvents;while(a.length>0)a[0].track.removeTrackEvent(a[0]);while(A.length>0)A[0].destroy(),H.removeTarget(A[0]);while(y.length>0)y[0].destroy(),H.removeMedia(y[0])},this.getMediaByType=function(a,b){for(var c=0,d=y.length;c<d;c++)if(y[c][a]===b)return y[c];return undefined},this.addMedia=function(a){a instanceof h||(a=new h(a)),a.popcornCallbacks=L,a.popcornScripts=J,y.push(a),H.chain(a,["mediacontentchanged","mediadurationchanged","mediatargetchanged","mediatimeupdate","mediaready","trackadded","trackremoved","tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated"]);var b;if(a.tracks.length>0)for(var c=0,d=a.tracks.length;c<d;++c){var e=a.tracks[c];b=e.trackEvents,a.dispatch("trackadded",e);if(b.length>0)for(var f=0,g=b.length;f<g;++f)e.dispatch("trackeventadded",b[f])}return a.listen("trackeventrequested",R),a.listen("mediaplayertyperequired",Q),H.dispatch("mediaadded",a),z||(H.currentMedia=a),a.setupContent(),a},this.removeMedia=function(a){var b=y.indexOf(a);if(b>-1){y.splice(b,1),H.unchain(a,["mediacontentchanged","mediadurationchanged","mediatargetchanged","mediatimeupdate","mediaready","trackadded","trackremoved","tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated"]);var c=a.tracks;for(var d=0,e=c.length;d<e;++d)H.dispatch("trackremoved",c[d]);return a===z&&(z=undefined),a.unlisten("trackeventrequested",R),a.unlisten("mediaplayertyperequired",Q),H.dispatch("mediaremoved",a),a}return undefined},this.extend=function(){v.extend(H,[].slice.call(arguments,1))},Object.defineProperties(H,{defaultTarget:{enumerable:!0,get:function(){return G}},config:{enumerable:!0,get:function(){return E}},id:{get:function(){return B},enumerable:!0},tracks:{get:function(){return z.tracks},enumerable:!0},targets:{get:function(){return A},enumerable:!0},currentTime:{get:function(){return N(),z.currentTime},set:function(a){N(),z.currentTime=a},enumerable:!0},duration:{get:function(){return N(),z.duration},set:function(a){N(),z.duration=a},enumerable:!0},media:{get:function(){return y},enumerable:!0},currentMedia:{get:function(){return z},set:function(a){typeof a=="string"&&(a=H.getMediaByType("id",a.id));if(a&&y.indexOf(a)>-1)return z=a,C.log("Media Changed: "+a.name),H.dispatch("mediachanged",a),z},enumerable:!0},selectedEvents:{get:function(){return I},set:function(a){I=a},enumerable:!0},debug:{get:function(){return e.enabled()},set:function(a){e.enabled(a)},enumerable:!0}});var S=this.preparePage=function(a){var b=D.scrape(),c=b.target,d=b.media;D.prepare(function(){if(!!E.value("scrapePage")){var b,e,f,g,h,i,j,k,l;for(b=0,f=c.length;b<f;++b){i=null;if(A.length>0)for(e=0,g=A.length;e<g;++e)if(A[e].id===c[b].id){i=A[e];break}i||H.addTarget({element:c[b].id})}for(b=0,f=d.length;b<f;b++){j=null,k=null,h="",l=d[b],l.getAttribute("data-butter-source")&&(h=l.getAttribute("data-butter-source"));if(y.length>0){for(e=0,g=y.length;e<g;++e)if(y[e].id!==d[b].id&&y[e].url!==h){j=y[e];break}}else E.value("mediaDefaults")&&(k=E.value("mediaDefaults"));j||H.addMedia({target:d[b].id,url:h,popcornOptions:k})}}a&&a(),H.dispatch("pageready")})};u.push(this),l.ready&&H.listen("ready",function(a){l.ready(a.data)});var T=this.preparePopcornScriptsAndCallbacks=function(a){function g(b){return function(c){this.readyState===4&&(this.status!==200?(J[b]="",C.log("WARNING: Trouble loading Popcorn script: "+this.response)):J[b]=this.response,++f,f===e.length&&a&&a())}}var b=E.value("popcorn")||{},c=b.callbacks,d=b.scripts,e=[],f=0;L=c;for(var h in d)if(d.hasOwnProperty(h)){var i=d[h],j=document.getElementById(i.substring(1));i.indexOf("#")===0?j&&(J[h]=j.innerHTML):e.push({url:i,onLoad:g(h)})}if(e.length>0)for(var k=0;k<e.length;++k)p.get(e[k].url,e[k].onLoad);else a()};if(l.config&&typeof l.config=="string"){var W=new XMLHttpRequest,X,Y=l.config+"?noCache="+Date.now();W.open("GET",Y,!1),W.overrideMimeType&&W.overrideMimeType("application/json"),W.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),W.send(null);if(W.status===200||W.status===0){try{X=f.parse(W.responseText)}catch(M){throw new Error("Butter config file not formatted properly.")}V(X)}else H.dispatch("configerror",H)}else V(l.config);this.page=D}var t=0,u=[],v=function(a){return new w(a)};v.showUAWarning=function(){var a=q.domFragment(s);document.body.appendChild(a),a.classList.add("slide-out"),a.getElementsByClassName("close-button")[0].onclick=function(){document.body.removeChild(a)}},v.Editor=n,v.instances=u,v.version="0.5";if(window.Butter.__waiting){for(var x=0,y=window.Butter.__waiting.length;x<y;++x)v.apply({},window.Butter.__waiting[x]);delete v._waiting}return window.Butter=v,v})}()})()